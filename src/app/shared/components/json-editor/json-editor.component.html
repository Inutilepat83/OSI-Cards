<div class="flex flex-col h-full">
  <!-- JSON Configuration Header -->
  <div class="editor-toolbar" role="group" aria-label="JSON editor controls">
    <label for="json-config-textarea" class="flex items-center gap-2">
      <div class="file-text-icon w-5 h-5" aria-hidden="true"></div>
    </label>

    <div class="editor-toolbar__actions">
      <p id="json-editor-instructions" class="editor-toolbar__hint">
        Tip: Press <span class="kbd">⌘⏎</span> or <span class="kbd">Ctrl⏎</span> to format JSON.
      </p>
      <button
        type="button"
        class="editor-toolbar__button"
        (click)="formatJson()"
        [attr.aria-label]="'Format JSON'"
        title="Format JSON">
        <span>Format</span>
      </button>
    </div>

    <span class="badge-destructive" *ngIf="!isJsonValid">Invalid JSON</span>
  </div>

  <!-- Live status messaging for screen readers -->
  <div class="sr-only" [attr.role]="isStatusAssertive ? 'alert' : 'status'" [attr.aria-live]="isStatusAssertive ? 'assertive' : 'polite'" aria-atomic="true">
    {{ editorStatus }}
  </div>

  <!-- JSON Textarea -->
  <textarea
    id="json-config-textarea"
    #textareaRef
    [(ngModel)]="jsonInput"
    (ngModelChange)="onJsonInputChange()"
    (keydown)="onTextareaKeydown($event)"
    [ngClass]="{
      'json-editor-textarea': true,
      'font-mono': true,
      'text-sm': true,
      'resize-none': true,
      'overflow-y-auto': true,
      'transition-all': true,
      'duration-300': true,
      'flex-1': true,
      'w-full': true,
      'text-foreground': true,
      'border-gray-600': isJsonValid,
      'border-red-500/50': !isJsonValid
    }"
    [attr.aria-invalid]="!isJsonValid"
    [attr.aria-describedby]="jsonError ? 'json-error-message' : 'json-editor-instructions'"
    placeholder="Enter your card configuration JSON here..."
    aria-label="JSON configuration editor for card customization"
    aria-multiline="true"
    aria-live="off"></textarea>
</div>

<!-- Error Message -->
<div
  id="json-error-message"
  class="p-2 bg-red-500/10 border border-red-500/20 rounded text-sm text-red-400"
  *ngIf="jsonError"
  role="alert"
  aria-live="assertive">
  <strong>JSON Error:</strong> {{ jsonError }}
</div>
