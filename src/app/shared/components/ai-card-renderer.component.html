<div class="card-container" #cardContainer (mouseenter)="onMouseEnter()" (mouseleave)="onMouseLeave()">
  <app-tilt-wrapper [isActive]="isTiltActive" [isHovered]="isHovered" className="card-tilt-wrapper">
    <div class="card-wrapper" [ngClass]="{'fullscreen': isFullscreen}">
      <!-- Card Header -->
      <div class="card-header">
        <div class="title-section">
          <h2 class="card-title">{{cardConfig.cardTitle}}</h2>
          <p *ngIf="cardConfig.cardSubtitle" class="card-subtitle">{{cardConfig.cardSubtitle}}</p>
        </div>
        
        <div class="card-actions">
          <button class="action-btn" 
                  (click)="toggleFullscreen()" 
                  (keydown.enter)="toggleFullscreen()" 
                  (keydown.space)="$event.preventDefault(); toggleFullscreen()"
                  [attr.aria-label]="isFullscreen ? 'Exit fullscreen' : 'Enter fullscreen'"
                  role="button"
                  tabindex="0">
            <i [ngClass]="isFullscreen ? 'minimize-icon' : 'maximize-icon'"></i>
          </button>
        </div>
      </div>
      
      <!-- Card Content / Sections -->
      <div class="card-content">
        <ng-container *ngFor="let section of cardConfig.sections; let i = index; trackBy: trackByIndex">
          <div class="card-section section-card" [ngClass]="'section-type-' + section.type">
            <div class="section-card-header" 
                 tabindex="0"
                 role="button"
                 (click)="toggleSection(i)"
                 (keydown.enter)="toggleSection(i)"
                 (keydown.space)="toggleSection(i)"
                 [attr.aria-expanded]="isSectionExpanded(i, section)"
                 [attr.aria-label]="'Toggle ' + section.title + ' section'">
              <div class="header-left">
                <h3 class="section-title">{{section.title}}</h3>
                <div *ngIf="section.description" class="section-desc">{{section.description}}</div>
              </div>
              <div class="header-right">
                <button class="collapse-btn" 
                        (click)="toggleSection(i)"
                        (keydown.enter)="toggleSection(i)"
                        (keydown.space)="$event.preventDefault(); toggleSection(i)"
                        [attr.aria-expanded]="isSectionExpanded(i, section)"
                        [attr.aria-label]="'Toggle ' + section.title + ' section'"
                        role="button"
                        tabindex="0">
                  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path [attr.d]="isSectionExpanded(i, section) ? 'M6 9l6 6 6-6' : 'M6 15l6-6 6 6'" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                </button>
              </div>
            </div>

            <div [ngClass]="{'collapsed': !isSectionExpanded(i, section)}" class="section-card-body">
              <!-- Info Section Type -->
              <div *ngIf="section.type === 'info' && section.fields" class="info-grid">
                <div *ngFor="let field of section.fields; trackBy: trackByIndex" 
                     class="field-card group" 
                     (click)="onFieldClick(field)"
                     (keydown.enter)="onFieldClick(field)"
                     (keydown.space)="$event.preventDefault(); onFieldClick(field)"
                     [attr.aria-label]="'View details for ' + field.label"
                     role="button"
                     tabindex="0">
                  <div class="field-card-left">
                    <div class="field-icon">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path [attr.d]="getFieldIconPath(field)" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                      </svg>
                    </div>
                  </div>
                  <div class="field-card-body">
                    <div class="field-label">{{field.label}}</div>
                    <div class="field-value" [style.color]="field.valueColor">{{field.value}}</div>
                    <div class="field-meta" *ngIf="field.percentage !== undefined || field.change !== undefined || field.trend">
                      <div *ngIf="field.percentage !== undefined" class="meta-item">
                        <div class="meta-label">Progress</div>
                        <div class="meta-value">{{field.percentage}}%</div>
                      </div>
                      <div *ngIf="field.change !== undefined" class="meta-item">
                        <div class="meta-label">Change</div>
                        <div class="meta-value" [ngClass]="field.change >= 0 ? 'positive' : 'negative'">
                          {{field.change >= 0 ? '+' : ''}}{{field.change}}%
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            
            <!-- List Section Type -->
            <div *ngIf="section.type === 'list' && section.items" class="list-container">
              <div *ngFor="let item of section.items; trackBy: trackByIndex" class="list-item">
                <div *ngIf="item.icon" class="item-icon">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path [attr.d]="getItemIconPath(item)" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                  </svg>
                </div>
                <div class="item-content">
                  <div class="item-title">{{item.title}}</div>
                  <div *ngIf="item.description" class="item-description">{{item.description}}</div>
                </div>
                <div *ngIf="item.value" class="item-value">{{item.value}}</div>
              </div>
            </div>
            
            <!-- Chart Section Placeholder -->
            <div *ngIf="section.type === 'chart'" class="chart-container">
              <div class="chart-placeholder">Chart would render here</div>
            </div>
            
            <!-- Map Section Placeholder -->
            <div *ngIf="section.type === 'map'" class="map-container">
              <div class="map-placeholder">Map would render here</div>
            </div>
            
            <!-- Other section types would be implemented similarly -->
            <div *ngIf="!['info', 'list', 'chart', 'map'].includes(section.type)" class="section-placeholder">
              {{section.type}} section would render here
            </div>
            </div>
          </div>
        </ng-container>
      </div>
      
      <!-- Card Footer / Actions -->
      <div *ngIf="cardConfig.actions && cardConfig.actions.length > 0" class="card-footer">
        <button *ngFor="let action of cardConfig.actions; trackBy: trackByIndex"
                class="card-action-btn"
                [ngClass]="'btn-' + (action.variant || 'primary')"
                (click)="onActionClick(action.label)"
                (keydown.enter)="onActionClick(action.label)"
                (keydown.space)="$event.preventDefault(); onActionClick(action.label)"
                [attr.aria-label]="action.label + ' action'"
                role="button"
                tabindex="0">
          <svg *ngIf="action.icon" class="w-4 h-4 action-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path [attr.d]="getActionIconPath(action)" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
          </svg>
          <span>{{action.label}}</span>
        </button>
      </div>
    </div>
  </app-tilt-wrapper>
  
  <!-- Add particle system for enhanced visual effect -->
  <!-- <app-particle-system *ngIf="isHovered"></app-particle-system> -->
</div>
