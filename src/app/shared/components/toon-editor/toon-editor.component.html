<div class="toon-editor flex flex-col h-full">
  <!-- TOON Configuration Header -->
  <div class="editor-toolbar" role="group" aria-label="TOON editor controls">
    <label for="toon-config-textarea" class="flex items-center gap-2">
      <div class="file-text-icon w-5 h-5" aria-hidden="true"></div>
    </label>

    <div class="editor-toolbar__actions">
      <div class="editor-toolbar__hint-stack">
        <p id="toon-editor-instructions" class="editor-toolbar__hint">
          Tip: Press <span class="kbd">⌘⏎</span> or <span class="kbd">Ctrl⏎</span> to format TOON.
        </p>
        <p *ngIf="llmStatusMessage" class="editor-toolbar__status" [class.editor-toolbar__status--active]="isSimulatingLLM">
          {{ llmStatusMessage }}
        </p>
      </div>
      <div class="editor-toolbar__buttons">
        <button
          type="button"
          class="editor-toolbar__button editor-toolbar__button--brand"
          (click)="onSimulationClick()"
          [attr.aria-pressed]="isSimulatingLLM"
          [disabled]="!toonInput.trim().length && !isSimulatingLLM"
          [attr.aria-label]="isSimulatingLLM ? 'Stop LLM simulation' : 'Simulate LLM generation'"
          title="Simulate LLM generation">
          <span class="editor-toolbar__spinner" *ngIf="isSimulatingLLM" aria-hidden="true"></span>
          <span>{{ isSimulatingLLM ? 'Stop Simulation' : 'Simulate LLM' }}</span>
        </button>
        <button
          type="button"
          class="editor-toolbar__button"
          (click)="formatToon()"
          [attr.aria-label]="'Format TOON'"
          title="Format TOON">
          <span>Format</span>
        </button>
      </div>
    </div>

    <span class="badge-destructive" *ngIf="!isToonValid">Invalid TOON</span>
  </div>

  <!-- Live status messaging for screen readers -->
  <div class="sr-only" [attr.role]="isStatusAssertive ? 'alert' : 'status'" [attr.aria-live]="isStatusAssertive ? 'assertive' : 'polite'" aria-atomic="true">
    {{ editorStatus }}
  </div>

  <!-- TOON Textarea -->
  <div class="toon-editor-overlay" *ngIf="isBusy" aria-hidden="true">
    <div class="toon-editor-overlay__inner">
      <svg class="spinner" viewBox="0 0 50 50" fill="none" stroke="currentColor" width="24" height="24">
        <circle cx="25" cy="25" r="20" stroke-width="5" stroke-opacity="0.25"></circle>
        <path d="M45 25a20 20 0 0 1-20 20" stroke-width="5" stroke-linecap="round"></path>
      </svg>
      <span>Loading template…</span>
    </div>
  </div>
  <textarea
    id="toon-config-textarea"
    #textareaRef
    [(ngModel)]="toonInput"
    (ngModelChange)="onToonInputChange()"
    (keydown)="onTextareaKeydown($event)"
    [readOnly]="isSimulatingLLM"
    [ngClass]="{
      'toon-editor-textarea': true,
      'font-mono': true,
      'text-sm': true,
      'resize-none': true,
      'overflow-y-auto': true,
      'transition-all': true,
      'duration-300': true,
      'flex-1': true,
      'w-full': true,
      'text-foreground': true,
      'border-gray-600': isToonValid,
      'border-red-500/50': !isToonValid
    }"
    [attr.aria-invalid]="!isToonValid"
    [attr.aria-describedby]="toonError ? 'toon-error-message' : 'toon-editor-instructions'"
    [attr.aria-live]="isSimulatingLLM ? 'polite' : 'off'"
    placeholder="Enter your card configuration TOON here..."
    aria-label="TOON configuration editor for card customization"
    aria-multiline="true"></textarea>
</div>

<!-- Error Message -->
<div
  id="toon-error-message"
  class="p-2 bg-red-500/10 border border-red-500/20 rounded text-sm text-red-400"
  *ngIf="toonError"
  role="alert"
  aria-live="assertive">
  <strong>TOON Error:</strong> {{ toonError }}
</div>
