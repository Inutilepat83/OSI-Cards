{
  "pageId": "library-docs/agentic-flow",
  "title": "OSI Cards Library - Agentic Flow Integration Guide",
  "html": "<h1 id=\"osi-cards-library-agentic-flow-integration-guide\"><a href=\"#osi-cards-library-agentic-flow-integration-guide\" class=\"anchor-link\" aria-hidden=\"true\">#</a>OSI Cards Library - Agentic Flow Integration Guide</h1></p><p>This guide explains how to integrate OSI Cards library with LLM-powered agentic flows, where router-triggered agents generate card data progressively during LLM responses.</p><p><h2 id=\"overview\"><a href=\"#overview\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Overview</h2></p><p>In an agentic flow integration:\n<ol><li><strong>LLM Response</strong> triggers a router action</li><li><strong>Router</strong> calls an agentic flow service</li><li><strong>Agent Flow</strong> starts executing and instantiates a card</li><li><strong>JSON Stream</strong> flows from agent as it executes</li><li><strong>Card Component</strong> receives partial JSON and updates progressively</li><li><strong>Card Completes</strong> when agent flow finishes</li></ol>\n<h2 id=\"architecture-flow\"><a href=\"#architecture-flow\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Architecture Flow</h2></p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">text</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-text\">┌─────────────────┐<br>│  LLM Response   │<br>└────────┬────────┘<br>         │<br>         ▼<br>┌─────────────────┐<br>│  Router Trigger │<br>└────────┬────────┘<br>         │<br>         ▼<br>┌─────────────────┐<br>│ Agent Flow Start│<br>└────────┬────────┘<br>         │<br>         ▼<br>┌─────────────────┐      ┌──────────────────┐<br>│ Card Instantiate│◄─────┤  Card Component  │<br>└────────┬────────┘      └──────────────────┘<br>         │<br>         ▼<br>┌─────────────────┐<br>│  JSON Stream    │──────► Progressive Updates<br>└────────┬────────┘<br>         │<br>         ▼<br>┌─────────────────┐<br>│  Card Complete  │<br>└─────────────────┘</code></pre></div></p><p><h2 id=\"quick-start\"><a href=\"#quick-start\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Quick Start</h2></p><p><h3 id=\"step-1-configure-providers\"><a href=\"#step-1-configure-providers\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Step 1: Configure Providers</h3></p><p>Ensure you have the library providers configured in your <code>app.config.ts</code>:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">import { ApplicationConfig } from '@angular/core';<br>import { provideOSICards } from 'osi-cards-lib';</p><p>export const appConfig: ApplicationConfig = {<br>  providers: [<br>    provideOSICards(), // Required for animations<br>    // ... other providers<br>  ]<br>};</code></pre></div></p><p><h3 id=\"step-2-create-agent-flow-service\"><a href=\"#step-2-create-agent-flow-service\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Step 2: Create Agent Flow Service</h3></p><p>Create a service that executes agentic flows and emits JSON streams:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">import { Injectable } from '@angular/core';<br>import { Observable, Subject } from 'rxjs';<br>import { AICardConfig } from 'osi-cards-lib';</p><p>@Injectable({ providedIn: 'root' })<br>export class AgentFlowService {<br>  <br>  /*<em>\n   </em> Execute an agentic flow and emit card configuration progressively<br>   */<br>  executeAgentFlow(agentPrompt: string, context?: any): Observable&amp;lt;Partial&amp;lt;AICardConfig&amp;gt;&amp;gt; {<br>    const subject = new Subject&amp;lt;Partial&amp;lt;AICardConfig&amp;gt;&amp;gt;();<br>    <br>    // Simulate agent flow execution<br>    // In real implementation, this would connect to your LLM/agent system<br>    this.executeFlow(agentPrompt, context, (partialCard) =&amp;gt; {<br>      subject.next(partialCard);<br>    }).then((completeCard) =&amp;gt; {<br>      subject.next(completeCard);<br>      subject.complete();<br>    }).catch((error) =&amp;gt; {<br>      subject.error(error);<br>    });<br>    <br>    return subject.asObservable();<br>  }<br>  <br>  private async executeFlow(<br>    prompt: string, <br>    context: any,<br>    onUpdate: (partial: Partial&amp;lt;AICardConfig&amp;gt;) =&amp;gt; void<br>  ): Promise&amp;lt;AICardConfig&amp;gt; {<br>    // Your agent flow implementation<br>    // This is a placeholder - replace with your actual agent execution<br>    <br>    // Example: Emit initial card structure<br>    onUpdate({<br>      cardTitle: 'Loading...',<br>      sections: []<br>    });<br>    <br>    // Simulate progressive updates<br>    await this.delay(500);<br>    onUpdate({<br>      cardTitle: 'Company Profile',<br>      sections: [<br>        { title: 'Overview', type: 'overview', fields: [] }<br>      ]<br>    });<br>    <br>    await this.delay(500);<br>    onUpdate({<br>      cardTitle: 'Company Profile',<br>      sections: [<br>        {<br>          title: 'Overview',<br>          type: 'overview',<br>          fields: [<br>            { label: 'Name', value: 'Acme Corp' }<br>          ]<br>        }<br>      ]<br>    });<br>    <br>    // Return complete card<br>    return {<br>      cardTitle: 'Company Profile',<br>      sections: [<br>        {<br>          title: 'Overview',<br>          type: 'overview',<br>          fields: [<br>            { label: 'Name', value: 'Acme Corp' },<br>            { label: 'Industry', value: 'Technology' }<br>          ]<br>        }<br>      ]<br>    };<br>  }<br>  <br>  private delay(ms: number): Promise&amp;lt;void&amp;gt; {<br>    return new Promise(resolve =&amp;gt; setTimeout(resolve, ms));<br>  }<br>}</code></pre></div></p><p><h3 id=\"step-3-create-router-triggered-component\"><a href=\"#step-3-create-router-triggered-component\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Step 3: Create Router-Triggered Component</h3></p><p>Create a component that handles router-triggered agent flows:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">import { Component, OnInit, inject, ChangeDetectorRef } from '@angular/core';<br>import { ActivatedRoute } from '@angular/router';<br>import { AICardRendererComponent, AICardConfig, StreamingStage } from 'osi-cards-lib';<br>import { AgentFlowService } from './agent-flow.service';<br>import { merge, scan } from 'rxjs';</p><p>@Component({<br>  selector: 'app-agent-card-view',<br>  standalone: true,<br>  imports: [AICardRendererComponent],<br>  template: <code>\n    &lt;div class=\"card-container\"&amp;gt;<br>      &amp;lt;app-ai-card-renderer<br>        [cardConfig]=\"cardConfig\"<br>        [streamingStage]=\"streamingStage\"<br>        (fieldInteraction)=\"onFieldInteraction($event)\"&amp;gt;<br>      &amp;lt;/app-ai-card-renderer&amp;gt;<br>    &lt;/div&gt;<br>  </code>\n})<br>export class AgentCardViewComponent implements OnInit {<br>  private route = inject(ActivatedRoute);<br>  private agentFlowService = inject(AgentFlowService);<br>  private cdr = inject(ChangeDetectorRef);<br>  <br>  cardConfig: AICardConfig | null = null;<br>  streamingStage: StreamingStage = 'idle';<br>  <br>  ngOnInit(): void {<br>    // Get agent prompt from route params or query params<br>    const agentPrompt = this.route.snapshot.queryParams['prompt'] || <br>                       this.route.snapshot.params['prompt'];<br>    <br>    if (agentPrompt) {<br>      this.executeAgentFlow(agentPrompt);<br>    }<br>  }<br>  <br>  private executeAgentFlow(prompt: string): void {<br>    this.streamingStage = 'thinking';<br>    this.cdr.markForCheck();<br>    <br>    // Initialize with empty card<br>    this.cardConfig = {<br>      cardTitle: 'Loading...',<br>      sections: []<br>    };<br>    <br>    // Execute agent flow and accumulate updates<br>    this.agentFlowService.executeAgentFlow(prompt)<br>      .pipe(<br>        scan((acc: AICardConfig, update: Partial&amp;lt;AICardConfig&amp;gt;) =&amp;gt; {<br>          // Merge partial updates into accumulated card<br>          return this.mergeCardConfig(acc, update);<br>        }, this.cardConfig)<br>      )<br>      .subscribe({<br>        next: (card) =&amp;gt; {<br>          this.cardConfig = card;<br>          this.streamingStage = 'streaming';<br>          this.cdr.markForCheck();<br>        },<br>        complete: () =&amp;gt; {<br>          this.streamingStage = 'complete';<br>          this.cdr.markForCheck();<br>        },<br>        error: (error) =&amp;gt; {<br>          this.streamingStage = 'error';<br>          console.error('Agent flow error:', error);<br>          this.cdr.markForCheck();<br>        }<br>      });<br>  }<br>  <br>  private mergeCardConfig(<br>    existing: AICardConfig, <br>    update: Partial&amp;lt;AICardConfig&amp;gt;<br>  ): AICardConfig {<br>    return {<br>      ...existing,<br>      ...update,<br>      sections: update.sections || existing.sections<br>    };<br>  }<br>  <br>  onFieldInteraction(event: any): void {<br>    console.log('Field interaction:', event);<br>  }<br>}</code></pre></div></p><p><h3 id=\"step-4-configure-router\"><a href=\"#step-4-configure-router\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Step 4: Configure Router</h3></p><p>Add route configuration to trigger agent flows:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">import { Routes } from '@angular/router';<br>import { AgentCardViewComponent } from './agent-card-view.component';</p><p>export const routes: Routes = [<br>  {<br>    path: 'agent-card/:prompt',<br>    component: AgentCardViewComponent<br>  },<br>  {<br>    path: 'agent-card',<br>    component: AgentCardViewComponent,<br>    // Can also use query params: /agent-card?prompt=...<br>  }<br>];</code></pre></div></p><p><h2 id=\"advanced-patterns\"><a href=\"#advanced-patterns\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Advanced Patterns</h2></p><p><h3 id=\"progressive-section-building\"><a href=\"#progressive-section-building\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Progressive Section Building</h3></p><p>For agents that build sections incrementally:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">private mergeCardConfig(<br>  existing: AICardConfig, <br>  update: Partial&amp;lt;AICardConfig&amp;gt;<br>): AICardConfig {<br>  const merged: AICardConfig = {<br>    ...existing,<br>    ...update<br>  };<br>  <br>  // Merge sections progressively<br>  if (update.sections) {<br>    const sectionMap = new Map(<br>      existing.sections.map(s =&amp;gt; [s.id || s.title, s])<br>    );<br>    <br>    update.sections.forEach(updateSection =&amp;gt; {<br>      const key = updateSection.id || updateSection.title;<br>      const existingSection = sectionMap.get(key);<br>      <br>      if (existingSection) {<br>        // Merge fields into existing section<br>        sectionMap.set(key, {<br>          ...existingSection,<br>          ...updateSection,<br>          fields: [<br>            ...(existingSection.fields || []),<br>            ...(updateSection.fields || [])<br>          ]<br>        });<br>      } else {<br>        // Add new section<br>        sectionMap.set(key, updateSection);<br>      }<br>    });<br>    <br>    merged.sections = Array.from(sectionMap.values());<br>  }<br>  <br>  return merged;<br>}</code></pre></div></p><p><h3 id=\"agent-flow-states\"><a href=\"#agent-flow-states\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Agent Flow States</h3></p><p>Track agent execution states:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">type AgentFlowState = <br>  | { status: 'idle' }<br>  | { status: 'thinking' }<br>  | { status: 'streaming'; card: Partial&amp;lt;AICardConfig&amp;gt; }<br>  | { status: 'complete'; card: AICardConfig }<br>  | { status: 'error'; error: Error };</p><p>@Component({...})<br>export class AgentCardViewComponent {<br>  flowState: AgentFlowState = { status: 'idle' };<br>  <br>  executeAgentFlow(prompt: string): void {<br>    this.flowState = { status: 'thinking' };<br>    <br>    this.agentFlowService.executeAgentFlow(prompt).subscribe({<br>      next: (update) =&amp;gt; {<br>        this.flowState = { <br>          status: 'streaming', <br>          card: update <br>        };<br>        this.updateCardConfig(update);<br>      },<br>      complete: () =&amp;gt; {<br>        this.flowState = { <br>          status: 'complete', <br>          card: this.cardConfig! <br>        };<br>      },<br>      error: (error) =&amp;gt; {<br>        this.flowState = { status: 'error', error };<br>      }<br>    });<br>  }<br>}</code></pre></div></p><p><h3 id=\"error-handling-and-retry\"><a href=\"#error-handling-and-retry\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Error Handling and Retry</h3></p><p>Handle agent flow failures:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">import { retry, catchError, timeout } from 'rxjs/operators';<br>import { of } from 'rxjs';</p><p>executeAgentFlow(prompt: string): void {<br>  this.agentFlowService.executeAgentFlow(prompt)<br>    .pipe(<br>      timeout(30000), // 30 second timeout<br>      retry({<br>        count: 3,<br>        delay: 1000<br>      }),<br>      catchError((error) =&amp;gt; {<br>        console.error('Agent flow failed:', error);<br>        this.streamingStage = 'error';<br>        // Provide fallback card<br>        this.cardConfig = this.createErrorCard(error);<br>        return of(null);<br>      })<br>    )<br>    .subscribe({<br>      next: (update) =&amp;gt; {<br>        if (update) {<br>          this.updateCardConfig(update);<br>        }<br>      }<br>    });<br>}</p><p>private createErrorCard(error: Error): AICardConfig {<br>  return {<br>    cardTitle: 'Error',<br>    sections: [<br>      {<br>        title: 'Error',<br>        type: 'info',<br>        fields: [<br>          { <br>            label: 'Message', <br>            value: error.message || 'An error occurred' <br>          }<br>        ]<br>      }<br>    ]<br>  };<br>}</code></pre></div></p><p><h3 id=\"router-guards-for-pre-instantiation\"><a href=\"#router-guards-for-pre-instantiation\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Router Guards for Pre-instantiation</h3></p><p>Use route guards to pre-instantiate cards before agent starts:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">import { Injectable, inject } from '@angular/core';<br>import { CanActivate, ActivatedRouteSnapshot } from '@angular/router';<br>import { AgentFlowService } from './agent-flow.service';</p><p>@Injectable({ providedIn: 'root' })<br>export class AgentCardGuard implements CanActivate {<br>  private agentFlowService = inject(AgentFlowService);<br>  <br>  canActivate(route: ActivatedRouteSnapshot): boolean {<br>    const prompt = route.params['prompt'] || route.queryParams['prompt'];<br>    <br>    if (prompt) {<br>      // Pre-validate prompt before navigating<br>      // Could also pre-instantiate skeleton card here<br>      return true;<br>    }<br>    <br>    return false;<br>  }<br>}</code></pre></div></p><p><h3 id=\"resolvers-for-pre-loading\"><a href=\"#resolvers-for-pre-loading\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Resolvers for Pre-loading</h3></p><p>Use resolvers to start agent flow before component loads:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">import { Injectable, inject } from '@angular/core';<br>import { Resolve, ActivatedRouteSnapshot } from '@angular/router';<br>import { Observable, of } from 'rxjs';<br>import { AgentFlowService } from './agent-flow.service';<br>import { AICardConfig } from 'osi-cards-lib';</p><p>@Injectable({ providedIn: 'root' })<br>export class AgentCardResolver implements Resolve&amp;lt;Observable&amp;lt;AICardConfig&amp;gt;&amp;gt; {<br>  private agentFlowService = inject(AgentFlowService);<br>  <br>  resolve(route: ActivatedRouteSnapshot): Observable&amp;lt;AICardConfig&amp;gt; {<br>    const prompt = route.params['prompt'] || route.queryParams['prompt'];<br>    <br>    if (prompt) {<br>      // Start agent flow immediately<br>      return this.agentFlowService.executeAgentFlow(prompt);<br>    }<br>    <br>    return of({ cardTitle: '', sections: [] });<br>  }<br>}</code></pre></div></p><p><h2 id=\"component-lifecycle-during-agent-flow\"><a href=\"#component-lifecycle-during-agent-flow\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Component Lifecycle During Agent Flow</h2></p><p><h3 id=\"initialization-sequence\"><a href=\"#initialization-sequence\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Initialization Sequence</h3></p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">text</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-text\">1. Component Created<br>   ↓\n<ol><li>ngOnInit() called</li></ol>   ↓\n<ol><li>Agent Flow Triggered</li></ol>   ↓\n<ol><li>Card Instantiated (empty/skeleton)</li></ol>   ↓\n<ol><li>StreamingStage: 'thinking'</li></ol>   ↓\n<ol><li>First JSON Update Received</li></ol>   ↓\n<ol><li>StreamingStage: 'streaming'</li></ol>   ↓\n<ol><li>Progressive Updates (cardConfig updates)</li></ol>   ↓\n<ol><li>Agent Flow Completes</li></ol>   ↓\n<ol><li>StreamingStage: 'complete'</code></pre></div></li></ol>\n<h3 id=\"streamingstage-values\"><a href=\"#streamingstage-values\" class=\"anchor-link\" aria-hidden=\"true\">#</a>StreamingStage Values</h3></p><p><ul><li><code>'idle'</code>: Initial state, no agent active</li><li><code>'thinking'</code>: Agent flow started, no JSON yet</li><li><code>'streaming'</code>: Receiving partial JSON updates</li><li><code>'complete'</code>: Agent finished, card fully populated</li><li><code>'error'</code>: Agent flow failed</li><li><code>'aborted'</code>: Agent flow interrupted</li></ul>\n<h2 id=\"best-practices\"><a href=\"#best-practices\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Best Practices</h2></p><p><h3 id=\"1-initialize-card-early\"><a href=\"#1-initialize-card-early\" class=\"anchor-link\" aria-hidden=\"true\">#</a>1. Initialize Card Early</h3></p><p>Always instantiate a card structure (even if empty) before agent starts:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">this.cardConfig = {<br>  cardTitle: 'Loading...',<br>  sections: []<br>};<br>this.streamingStage = 'thinking';</code></pre></div></p><p><h3 id=\"2-use-change-detection-optimization\"><a href=\"#2-use-change-detection-optimization\" class=\"anchor-link\" aria-hidden=\"true\">#</a>2. Use Change Detection Optimization</h3></p><p>Use OnPush change detection and manually trigger updates:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">@Component({<br>  changeDetection: ChangeDetectionStrategy.OnPush<br>})<br>export class AgentCardViewComponent {<br>  private cdr = inject(ChangeDetectorRef);<br>  <br>  onUpdate(card: Partial&amp;lt;AICardConfig&amp;gt;): void {<br>    this.cardConfig = this.mergeCardConfig(this.cardConfig, card);<br>    this.cdr.markForCheck(); // Trigger change detection<br>  }<br>}</code></pre></div></p><p><h3 id=\"3-handle-interruptions\"><a href=\"#3-handle-interruptions\" class=\"anchor-link\" aria-hidden=\"true\">#</a>3. Handle Interruptions</h3></p><p>Allow users to cancel agent flows:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">private agentFlowSubscription?: Subscription;</p><p>executeAgentFlow(prompt: string): void {<br>  // Cancel previous flow if active<br>  this.agentFlowSubscription?.unsubscribe();<br>  <br>  this.agentFlowSubscription = this.agentFlowService<br>    .executeAgentFlow(prompt)<br>    .subscribe({...});<br>}</p><p>ngOnDestroy(): void {<br>  this.agentFlowSubscription?.unsubscribe();<br>}</code></pre></div></p><p><h3 id=\"4-optimize-json-merging\"><a href=\"#4-optimize-json-merging\" class=\"anchor-link\" aria-hidden=\"true\">#</a>4. Optimize JSON Merging</h3></p><p>Use efficient merging strategies:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">// Good: Merge incrementally<br>private mergeCardConfig(existing: AICardConfig, update: Partial&amp;lt;AICardConfig&amp;gt;): AICardConfig {<br>  // Smart merging logic<br>}</p><p>// Avoid: Full replacement (causes flicker)<br>this.cardConfig = update as AICardConfig; // ❌ Don't do this</code></pre></div></p><p><h3 id=\"5-provide-loading-feedback\"><a href=\"#5-provide-loading-feedback\" class=\"anchor-link\" aria-hidden=\"true\">#</a>5. Provide Loading Feedback</h3></p><p>Show skeleton or loading state:</p><p><div class=\"code-block-wrapper\"><div class=\"code-header\"><span class=\"code-lang\">typescript</span><div class=\"code-actions\"><button class=\"copy-btn\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path></svg>Copy</button></div></div><pre><code class=\"language-typescript\">get showSkeleton(): boolean {<br>  return this.streamingStage === 'thinking' || <br>         (this.streamingStage === 'streaming' &amp;amp;&amp;amp; !this.cardConfig?.sections?.length);<br>}</code></pre></div></p><p><h2 id=\"complete-example\"><a href=\"#complete-example\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Complete Example</h2></p><p>See <code>examples/agentic-flow-integration.example.ts</code> for a complete working example.</p><p><h2 id=\"related-documentation\"><a href=\"#related-documentation\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Related Documentation</h2></p><p><ul><li><a href=\"../README.md\">README.md</a> - Library overview</li><li><a href=\"./SERVICES.md\">SERVICES.md</a> - Service documentation</li><li><a href=\"../IMPORT_EXAMPLE.md\">IMPORT_EXAMPLE.md</a> - Import examples</li></ul>\n<h2 id=\"troubleshooting\"><a href=\"#troubleshooting\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Troubleshooting</h2></p><p><h3 id=\"card-not-updating\"><a href=\"#card-not-updating\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Card Not Updating</h3></p><p><strong>Issue</strong>: Card doesn't update during streaming</p><p><strong>Solution</strong>:\n<ul><li>Ensure <code>ChangeDetectorRef.markForCheck()</code> is called after updates</li><li>Verify <code>streamingStage</code> is being updated correctly</li><li>Check that card merging logic preserves all fields</li></ul>\n<h3 id=\"agent-flow-not-triggering\"><a href=\"#agent-flow-not-triggering\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Agent Flow Not Triggering</h3></p><p><strong>Issue</strong>: Router doesn't trigger agent flow</p><p><strong>Solution</strong>:\n<ul><li>Verify route parameters are being read correctly</li><li>Check router configuration</li><li>Ensure component is being created on route navigation</li></ul>\n<h3 id=\"performance-issues\"><a href=\"#performance-issues\" class=\"anchor-link\" aria-hidden=\"true\">#</a>Performance Issues</h3></p><p><strong>Issue</strong>: Too many updates causing performance problems</p><p><strong>Solution</strong>:\n<ul><li>Batch updates (use <code>debounceTime</code> or <code>throttleTime</code>)</li><li>Use <code>OnPush</code> change detection</li><li>Optimize card merging logic</li><li>Limit update frequency from agent</li></ul></p><p>",
  "toc": [
    {
      "id": "osi-cards-library-agentic-flow-integration-guide",
      "text": "OSI Cards Library - Agentic Flow Integration Guide",
      "level": 1
    },
    {
      "id": "overview",
      "text": "Overview",
      "level": 2
    },
    {
      "id": "architecture-flow",
      "text": "Architecture Flow",
      "level": 2
    },
    {
      "id": "quick-start",
      "text": "Quick Start",
      "level": 2
    },
    {
      "id": "step-1-configure-providers",
      "text": "Step 1: Configure Providers",
      "level": 3
    },
    {
      "id": "step-2-create-agent-flow-service",
      "text": "Step 2: Create Agent Flow Service",
      "level": 3
    },
    {
      "id": "step-3-create-router-triggered-component",
      "text": "Step 3: Create Router-Triggered Component",
      "level": 3
    },
    {
      "id": "step-4-configure-router",
      "text": "Step 4: Configure Router",
      "level": 3
    },
    {
      "id": "advanced-patterns",
      "text": "Advanced Patterns",
      "level": 2
    },
    {
      "id": "progressive-section-building",
      "text": "Progressive Section Building",
      "level": 3
    },
    {
      "id": "agent-flow-states",
      "text": "Agent Flow States",
      "level": 3
    },
    {
      "id": "error-handling-and-retry",
      "text": "Error Handling and Retry",
      "level": 3
    },
    {
      "id": "router-guards-for-pre-instantiation",
      "text": "Router Guards for Pre-instantiation",
      "level": 3
    },
    {
      "id": "resolvers-for-pre-loading",
      "text": "Resolvers for Pre-loading",
      "level": 3
    },
    {
      "id": "component-lifecycle-during-agent-flow",
      "text": "Component Lifecycle During Agent Flow",
      "level": 2
    },
    {
      "id": "initialization-sequence",
      "text": "Initialization Sequence",
      "level": 3
    },
    {
      "id": "streamingstage-values",
      "text": "StreamingStage Values",
      "level": 3
    },
    {
      "id": "best-practices",
      "text": "Best Practices",
      "level": 2
    },
    {
      "id": "1-initialize-card-early",
      "text": "1. Initialize Card Early",
      "level": 3
    },
    {
      "id": "2-use-change-detection-optimization",
      "text": "2. Use Change Detection Optimization",
      "level": 3
    },
    {
      "id": "3-handle-interruptions",
      "text": "3. Handle Interruptions",
      "level": 3
    },
    {
      "id": "4-optimize-json-merging",
      "text": "4. Optimize JSON Merging",
      "level": 3
    },
    {
      "id": "5-provide-loading-feedback",
      "text": "5. Provide Loading Feedback",
      "level": 3
    },
    {
      "id": "complete-example",
      "text": "Complete Example",
      "level": 2
    },
    {
      "id": "related-documentation",
      "text": "Related Documentation",
      "level": 2
    },
    {
      "id": "troubleshooting",
      "text": "Troubleshooting",
      "level": 2
    },
    {
      "id": "card-not-updating",
      "text": "Card Not Updating",
      "level": 3
    },
    {
      "id": "agent-flow-not-triggering",
      "text": "Agent Flow Not Triggering",
      "level": 3
    },
    {
      "id": "performance-issues",
      "text": "Performance Issues",
      "level": 3
    }
  ],
  "contentHash": "22828b12ac36c576",
  "generatedAt": "2025-12-01T09:15:43.743Z",
  "demoConfigs": {}
}