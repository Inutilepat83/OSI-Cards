---
description: "Use Architect MCP pattern validation for complex/novel code (optional for well-known patterns)"
priority: 1
---

# Architect MCP Enforcement

## When to Use Architect MCP

**Use Architect MCP for complex/novel code:**

1. **Query patterns** using `get_file_design_pattern` for the target file
2. **Generate code** following the returned patterns
3. **Validate code** using `review_code_change` after generation

**Skip Architect MCP for well-known patterns:**
- Standard Angular components (standalone, OnPush)
- Standard services (providedIn: 'root', inject())
- Section components (follows BaseSectionComponent pattern)
- Simple utilities
- Standard TypeScript patterns

## Workflow for Complex/Novel Code

### Step 1: Pre-Generation Pattern Query (For Complex Code)

**For complex/novel code**, call `get_file_design_pattern` before generating:

```
Before creating [file path], check what architectural patterns apply.
```

This ensures you receive:
- File-specific architectural requirements
- Design pattern guidelines
- Coding standards for that file type

### Step 2: Code Generation

Generate code following the patterns returned in Step 1.

### Step 3: Post-Generation Validation

**Call `review_code_change` after generating code (when using Architect MCP):**

```
Review [file path] for pattern compliance
```

This validates:
- Pattern adherence
- Severity rating (LOW/MEDIUM/HIGH)
- Specific violations
- Auto-fix suggestions

## When to Use vs Skip

### Use Architect MCP For:

- **Complex features** (new architecture patterns)
- **Novel code** (unfamiliar patterns)
- **Large refactoring** (major changes)
- **Critical code** (security, performance)

### Skip Architect MCP For:

- **Standard Angular components** (standalone, OnPush, standard patterns)
- **Standard services** (providedIn: 'root', inject(), signals)
- **Section components** (extends BaseSectionComponent, follows 5-file structure)
- **Simple utilities** (pure functions, helpers)
- **Minor changes** (bug fixes, small improvements)

## Automation Rules

### For New Files (Complex Code)

When creating complex/novel code:
1. ✅ Query patterns first
2. ✅ Generate following patterns
3. ✅ Validate after generation
4. ✅ Fix any HIGH severity violations
5. ✅ Document MEDIUM severity issues

### For Standard Patterns

When creating standard patterns (components, services, sections):
1. ✅ Follow established patterns directly
2. ✅ Reference existing code (e.g., "similar to CardFacadeService")
3. ✅ Skip pattern query (well-known patterns)
4. ✅ Validate manually if needed

### For Modified Files

When modifying existing files:
1. ✅ Match existing patterns in the file
2. ✅ Maintain consistency with file's style
3. ✅ Skip pattern query if changes are simple
4. ✅ Use pattern query for major refactoring

### For Service Files

**Standard services (skip Architect MCP - well-known pattern):**
- Use `providedIn: 'root'`
- Use `inject()` function
- Use signals for reactive state (Angular 20+)
- See existing services for examples: `CardFacadeService`, `LoggerService`

**Complex services (use Architect MCP):**
- Novel service patterns
- Complex integrations
- New architectural approaches

**Reference:** `projects/osi-cards-lib/src/lib/services/**/*.ts` for examples

### For Component Files

**Standard components (skip Architect MCP - well-known pattern):**
- Standalone components
- OnPush change detection
- Input/Output communication
- See existing components for examples: `AICardRendererComponent`, `CardActionsComponent`

**Section components (skip Architect MCP - well-known pattern):**
- Extend BaseSectionComponent
- Use section.definition.json
- 5-file structure
- See existing sections for examples: `AnalyticsSectionComponent`, `InfoSectionComponent`

**Complex components (use Architect MCP):**
- Novel component patterns
- Complex integrations
- New architectural approaches

**Reference:** `projects/osi-cards-lib/src/lib/components/**/*.component.ts` for examples

## Pattern Violation Handling

### HIGH Severity
- **Action:** Block or auto-fix immediately
- **Example:** Direct database access in service
- **Fix:** Use repository/provider pattern

### MEDIUM Severity
- **Action:** Flag for review
- **Example:** Minor pattern deviation
- **Fix:** Document or refactor

### LOW Severity
- **Action:** Auto-submit (pattern followed)
- **Example:** All patterns correctly applied

## MCP Tool Usage

### Pattern Query Tool

```typescript
// Always use before code generation
mcp_architect_get-file-design-pattern({
  file_path: "target/file/path.ts"
})
```

### Code Review Tool

```typescript
// Always use after code generation
mcp_architect_review-code-change({
  file_path: "target/file/path.ts"
})
```

## Enforcement Checklist

Before considering code complete:

- [ ] Patterns queried for target file
- [ ] Code generated following patterns
- [ ] Code validated against patterns
- [ ] HIGH severity violations fixed
- [ ] MEDIUM severity issues documented
- [ ] All applicable patterns followed

## Examples

### ✅ Correct Workflow

```
User: "Create a new UserService"

AI:
1. [Calls get_file_design_pattern for UserService]
2. Receives Service Layer Pattern requirements
3. Generates code following patterns
4. [Calls review_code_change]
5. Returns validation results
6. Fixes any violations
```

### ❌ Incorrect Workflow

```
User: "Create a new UserService"

AI:
1. Generates code without checking patterns
2. May violate architectural patterns
3. No validation performed
```

## Integration with Code Generation

### Automatic Pattern Application

When generating code, automatically:
1. Query patterns for the file
2. Apply patterns to code generation
3. Validate generated code
4. Fix violations automatically when possible

### Pattern-Aware Code Generation

Always generate code that:
- Follows Service Layer Pattern for services
- Follows Component Pattern for components
- Uses Dependency Injection correctly
- Manages RxJS subscriptions properly
- Handles errors appropriately
- Uses OnPush change detection
- Implements proper lifecycle management

## Reminders

**Remember:**
- Architect MCP is NOT optional
- Pattern validation happens BEFORE and AFTER code generation
- All violations must be addressed
- Pattern compliance is mandatory, not optional

**See also:**
- `templates/your-template/architect.yaml` - Pattern definitions
- `docs/development/ARCHITECT_MCP_SETUP.md` - Setup guide
- `templates/your-template/PATTERNS_SUMMARY.md` - Pattern reference
