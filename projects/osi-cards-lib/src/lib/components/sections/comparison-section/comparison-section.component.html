<div class="comparison-section">
  @if (items.length > 0) {
    <div class="comparison-table-wrapper">
      <table class="comparison-table" role="grid">
        <!-- Header row with item names -->
        <thead>
          <tr class="comparison-header-row">
            <th class="comparison-feature-header">Features</th>
            @for (item of items; track trackItem($index, item); let i = $index) {
              <th
                class="comparison-item-header"
                [class.comparison-item-header--highlighted]="isHighlighted(item)"
                (click)="onItemClick(item, i)"
                (keydown.enter)="onItemClick(item, i)"
                tabindex="0">

                @if (item.badge) {
                  <span class="comparison-badge">{{ item.badge }}</span>
                }

                <span class="comparison-item-name">{{ item.title }}</span>

                @if (item.price) {
                  <span class="comparison-item-price">{{ item.price }}</span>
                }

                @if (item.description) {
                  <span class="comparison-item-description">{{ item.description }}</span>
                }
              </th>
            }
          </tr>
        </thead>

        <tbody>
          <!-- Features without category -->
          @if (getFeaturesByCategory(null).length > 0) {
            @for (feature of getFeaturesByCategory(null); track feature.name) {
              <tr class="comparison-feature-row">
                <td class="comparison-feature-name">
                  <span>{{ feature.name }}</span>
                  @if (feature.description) {
                    <lucide-icon
                      name="info"
                      [size]="14"
                      class="comparison-feature-info"
                      [title]="feature.description">
                    </lucide-icon>
                  }
                </td>
                @for (item of items; track trackItem($index, item); let i = $index) {
                  <td
                    class="comparison-value"
                    [class.comparison-value--highlighted]="isHighlighted(item)"
                    [class.comparison-value--true]="getFeatureValue(feature, i) === true"
                    [class.comparison-value--false]="getFeatureValue(feature, i) === false">
                    @if (isBoolean(getFeatureValue(feature, i))) {
                      <lucide-icon
                        [name]="getFeatureValue(feature, i) ? 'check' : 'x'"
                        [size]="18"
                        [class.comparison-check]="getFeatureValue(feature, i) === true"
                        [class.comparison-cross]="getFeatureValue(feature, i) === false">
                      </lucide-icon>
                    } @else {
                      <span>{{ formatValue(getFeatureValue(feature, i)) }}</span>
                    }
                  </td>
                }
              </tr>
            }
          }

          <!-- Features by category -->
          @for (category of categories; track category) {
            <!-- Category header -->
            <tr class="comparison-category-row">
              <th [colSpan]="items.length + 1" class="comparison-category-header">
                {{ category }}
              </th>
            </tr>

            @for (feature of getFeaturesByCategory(category); track feature.name) {
              <tr class="comparison-feature-row">
                <td class="comparison-feature-name">
                  <span>{{ feature.name }}</span>
                  @if (feature.description) {
                    <lucide-icon
                      name="info"
                      [size]="14"
                      class="comparison-feature-info"
                      [title]="feature.description">
                    </lucide-icon>
                  }
                </td>
                @for (item of items; track trackItem($index, item); let i = $index) {
                  <td
                    class="comparison-value"
                    [class.comparison-value--highlighted]="isHighlighted(item)"
                    [class.comparison-value--true]="getFeatureValue(feature, i) === true"
                    [class.comparison-value--false]="getFeatureValue(feature, i) === false">
                    @if (isBoolean(getFeatureValue(feature, i))) {
                      <lucide-icon
                        [name]="getFeatureValue(feature, i) ? 'check' : 'x'"
                        [size]="18"
                        [class.comparison-check]="getFeatureValue(feature, i) === true"
                        [class.comparison-cross]="getFeatureValue(feature, i) === false">
                      </lucide-icon>
                    } @else {
                      <span>{{ formatValue(getFeatureValue(feature, i)) }}</span>
                    }
                  </td>
                }
              </tr>
            }
          }
        </tbody>
      </table>
    </div>
  } @else {
    <div class="comparison-empty">
      <lucide-icon name="columns" [size]="24"></lucide-icon>
      <span>No comparison data available</span>
    </div>
  }
</div>

