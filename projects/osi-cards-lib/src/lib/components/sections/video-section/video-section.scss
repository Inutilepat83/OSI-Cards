// =====================================================================
// VIDEO SECTION - Compact, Responsive, Consistent
// =====================================================================

// Use design system (must come before @import)
@use "../../../styles/components/sections/design-system" as *;
@use "../../../styles/components/sections/typography-system" as typo;
@use "../../../styles/responsive" as *;
@use "../../../styles/components/sections/section-animations" as *;

// Import base section styles
@import "../../../styles/components/sections/sections-base";
@import "../../../styles/components/sections/section-shell";

:host {
  display: block;
  width: 100%;
}

.video-container {
  display: flex;
  flex-direction: column;
  gap: var(--osi-section-header-gap);
}

.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(var(--osi-section-item-grid-min-xl), 1fr));
  gap: var(--osi-section-item-gap) !important;
  width: 100%; // Ensure full width
  box-sizing: border-box;
  min-width: 0; // Prevent grid overflow

  @include responsive-down("md") {
    grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
  }

  @include responsive-down("sm") {
    grid-template-columns: 1fr;
    gap: var(--osi-section-item-gap); // 6px gap between section items
  }
}

.section-item {
  @include card("normal");
  overflow: hidden;
  cursor: pointer;
  min-width: 0; // Prevent grid item overflow
  width: 100%; // Ensure full width of grid cell
  max-width: 100%; // Prevent overflow
  box-sizing: border-box; // Ensure proper box model
  display: flex; // Use flex layout
  flex-direction: column; // Stack children vertically

  // Unified hover effect
  @include section-card-hover;
}

.video-thumbnail {
  width: 100%;
  max-width: 100%; // Ensure responsive
  height: var(--osi-card-min-height-large);
  object-fit: cover;
  background: var(--osi-surface-hover);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  box-sizing: border-box; // Ensure proper box model

  &::after {
    content: "â–¶";
    position: absolute;
    font-size: var(--text-2xl);
    color: var(--accent-foreground);
    background: var(--accent);
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--osi-radius-full);
  }

  @include responsive-down("sm") {
    height: 100px;
    max-width: 100%; // Ensure responsive on mobile
  }
}

.video-info {
  // Add horizontal and bottom padding since video-wrapper extends to edges
  // Top padding not needed as flex gap handles spacing from video-wrapper
  padding-left: var(--osi-section-item-padding-normal);
  padding-right: var(--osi-section-item-padding-normal);
  padding-bottom: var(--osi-section-item-padding-normal);
  display: flex;
  flex-direction: column;
  gap: var(--osi-section-item-gap-xs);
  width: 100%; // Ensure full horizontal width
  max-width: 100%; // Prevent overflow
  min-width: 0; // Allow shrinking
  box-sizing: border-box; // Ensure proper box model
  flex: 1; // Take available space

  @include responsive-down("sm") {
    padding-left: var(--osi-section-item-padding-compact);
    padding-right: var(--osi-section-item-padding-compact);
    padding-bottom: var(--osi-section-item-padding-compact);
  }
}

.video-title {
  @include heading(6);
  @include text-overflow-ellipsis(2); // Limit to 2 lines
  overflow-wrap: break-word;
  word-wrap: break-word;
  width: 100%; // Ensure full width
  max-width: 100%; // Prevent overflow
  min-width: 0; // Allow shrinking
  box-sizing: border-box;
}

.video-description {
  @include body-text("small");
  color: var(--muted-foreground);
  margin: 0;
  line-height: var(--leading-relaxed);
  @include text-overflow-ellipsis(2); // Limit to 2 lines by default
  overflow-wrap: break-word;
  word-wrap: break-word;
  width: 100%; // Ensure full width
  max-width: 100%; // Prevent overflow
  min-width: 0; // Allow shrinking
  box-sizing: border-box;
  transition:
    color var(--osi-section-item-transition),
    opacity var(--osi-section-item-transition);
}

.video-description.expanded {
  @include text-overflow-ellipsis(unset); // Show full text when expanded
}

.video-expand-button {
  @include button-text-minimal;
  margin-top: var(--osi-section-item-gap-xs);
  align-self: flex-start;
  font-size: var(--text-sm);
  color: var(--accent);
  &:hover {
    text-decoration: underline;
  }
}

.video-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--osi-section-item-gap);
  font-size: var(--text-sm);
  color: var(--muted-foreground);
  width: 100%; // Ensure full horizontal width
  max-width: 100%; // Prevent overflow
  min-width: 0; // Allow shrinking
  box-sizing: border-box; // Ensure proper box model

  .video-meta-left {
    display: flex;
    gap: var(--osi-section-item-gap);
    align-items: center;
    flex-wrap: wrap;
    overflow-wrap: break-word;
    word-wrap: break-word;
    flex: 1; // Take available space
    min-width: 0; // Allow shrinking
    max-width: 100%; // Prevent overflow

    @include responsive-down("sm") {
      gap: var(--osi-section-item-gap-sm);
    }
  }

  .video-category {
    margin-left: auto; // Push category to the right
    flex-shrink: 0; // Prevent category from shrinking
    white-space: nowrap; // Prevent category from wrapping
  }
}

.video-wrapper {
  position: relative;
  width: calc(100% + var(--osi-section-item-padding-normal) * 2);
  margin-left: calc(var(--osi-section-item-padding-normal) * -1);
  margin-right: calc(var(--osi-section-item-padding-normal) * -1);
  margin-top: calc(var(--osi-section-item-padding-normal) * -1);
  aspect-ratio: 16 / 9; // Maintain 16:9 aspect ratio for responsive height
  min-height: 0; // Prevent minimum height issues
  background: var(--osi-surface-hover);
  // Only round top corners to match section-item border-radius
  border-radius: var(--osi-section-item-border-radius) var(--osi-section-item-border-radius) 0 0;
  overflow: hidden;
  flex-shrink: 0;
  box-sizing: border-box; // Ensure proper box model

  @include responsive-down("sm") {
    width: calc(100% + var(--osi-section-item-padding-compact) * 2);
    margin-left: calc(var(--osi-section-item-padding-compact) * -1);
    margin-right: calc(var(--osi-section-item-padding-compact) * -1);
    margin-top: calc(var(--osi-section-item-padding-compact) * -1);
  }

  iframe {
    position: absolute !important;
    inset: 0 !important; // Use inset for all sides (more reliable than individual properties)
    width: 100% !important;
    height: 100% !important;
    border: none !important;
    display: block !important;
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
    // Remove any conflicting styles
    aspect-ratio: unset !important;
    min-height: unset !important;
    max-height: unset !important;
    min-width: unset !important;
    max-width: unset !important;
    object-fit: unset !important;
    vertical-align: unset !important;
    // Ensure iframe fills container completely
    transform: none !important;
  }

  video {
    position: absolute;
    inset: 0; // Use inset for top/right/bottom/left all at once
    width: 100%;
    height: 100%;
    border: none;
    display: block;
    margin: 0;
    padding: 0;
    object-fit: cover;
    box-sizing: border-box;
  }
}

.video-error {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  min-height: 200px;
  background: var(--osi-surface-hover);
  color: var(--muted-foreground);
  text-align: center;
  padding: var(--osi-spacing-md);

  p {
    margin: 0;
    @include body-text("small");
  }
}
