<div class="ai-section ai-section--video section-content">
  <!-- Section Header -->
  <lib-section-header [title]="section.title" [description]="section.description"> </lib-section-header>

  <!-- Videos Grid -->
  <div class="video-container" *ngIf="section.items && section.items.length > 0">
    <div class="video-grid">
      <div class="section-item" *ngFor="let video of section.items; let i = index">
        <!-- Video Player/Thumbnail -->
        <div class="video-wrapper">
          <!-- Embedded Video (YouTube/Vimeo) -->
          <iframe
            [src]="getSafeVideoUrl(video)"
            *ngIf="isEmbeddable(getVideoUrl(video)) && getVideoUrl(video)"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            loading="lazy"
            title="{{ video.title || 'Video player' }}"
          >
          </iframe>

          <!-- Native Video -->
          <video
            [src]="getVideoUrl(video)"
            controls
            *ngIf="!isEmbeddable(getVideoUrl(video)) && getVideoUrl(video)"
            [poster]="getThumbnail(video)"
            [title]="video.title"
          ></video>

          <!-- Thumbnail Only (fallback when no video URL or embed failed) -->
          <img
            [src]="getThumbnail(video)"
            [alt]="video.title"
            *ngIf="!getVideoUrl(video) && getThumbnail(video)"
            class="video-thumbnail"
          />

          <!-- Error state when no video URL and no thumbnail -->
          <div *ngIf="!getVideoUrl(video) && !getThumbnail(video)" class="video-error">
            <p>Video unavailable</p>
          </div>
        </div>

        <!-- Video Info -->
        <div class="video-info">
          <h4 class="video-title">{{ video.title }}</h4>
          <p class="video-description" *ngIf="video.description" [class.expanded]="isDescriptionExpanded(i)">
            {{ video.description }}
          </p>
          <button
            *ngIf="shouldShowExpandButton(video)"
            class="video-expand-button"
            type="button"
            (click)="toggleDescriptionExpanded(i)"
            [attr.aria-expanded]="isDescriptionExpanded(i)"
            [attr.aria-label]="
              (isDescriptionExpanded(i) ? 'Show less' : 'Show more') + ' description for ' + video.title
            "
          >
            {{ isDescriptionExpanded(i) ? 'Show less' : 'Show more' }}
          </button>

          <div class="video-meta">
            <span class="video-duration" *ngIf="video.meta?.duration">{{ video.meta?.duration }}</span>
            <span class="video-platform" *ngIf="video.meta?.platform">{{ video.meta?.platform }}</span>
            <span class="video-views" *ngIf="video.meta?.views">{{ video.meta?.views }} views</span>
            <span class="video-category" *ngIf="video.meta?.category">{{ video.meta?.category }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <lib-empty-state
    *ngIf="(!section.fields && !section.items) || (section.fields?.length === 0 && section.items?.length === 0)"
    message="No video data"
    icon="ðŸŽ¥"
    variant="minimal"
  >
  </lib-empty-state>
</div>
