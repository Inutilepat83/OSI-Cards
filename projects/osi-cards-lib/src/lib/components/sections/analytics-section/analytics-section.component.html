<div class="ai-section ai-section--analytics section-content">
  <lib-section-header *ngIf="section.title" [title]="section.title" [description]="section.description">
  </lib-section-header>

  <div class="analytics-grid" *ngIf="section.fields?.length" [attr.data-density]="density">
    <div
      class="metric-card"
      [class.metric-card--expanded]="isMetricExpanded(metric, i)"
      *ngFor="let metric of section.fields; let i = index"
      (click)="toggleMetric(metric, i)"
      (keydown)="onMetricKeyDown($event, metric, i)"
      [attr.tabindex]="0"
      role="button"
      [attr.aria-expanded]="isMetricExpanded(metric, i)"
      [attr.aria-label]="'Metric: ' + metric.label + (isMetricExpanded(metric, i) ? ', expanded' : ', click to expand')"
    >
      <!-- Compact Header: Label -->
      <div class="metric-header">
        <span class="metric-label">{{ metric.label }}</span>
      </div>

      <!-- Main Value Row: Realized Value + Period -->
      <div class="metric-values">
        <div class="metric-value-primary">
          <span class="metric-value">{{ formatMetricValue(metric) }}</span>
          <span class="metric-period" *ngIf="getPeriod(metric)">{{ getPeriod(metric) }}</span>
        </div>

        <!-- Objective (Target) - Revealed on hover/expand via CSS -->
        <div class="metric-objective" *ngIf="hasGoal(metric)">
          <span class="metric-objective-label">Target:</span>
          <span class="metric-objective-value">{{ formatGoalValue(metric) }}</span>
        </div>
      </div>

      <!-- Progress Bar: Always shown if has progress data, label revealed on hover/expand -->
      <div class="metric-progress-row" *ngIf="metric.percentage !== undefined || hasGoal(metric)">
        <div class="metric-progress-wrapper">
          <div class="metric-progress-track">
            <div
              class="metric-progress-fill"
              [style.width.%]="getProgressPercentage(metric)"
              [ngClass]="getProgressClass(metric)"
            ></div>
            <div
              class="metric-progress-target"
              *ngIf="hasGoal(metric)"
              [style.left.%]="getTargetPercentage(metric)"
            ></div>
          </div>
          <!-- Progress label - Revealed on hover/expand via CSS -->
          <span class="metric-progress-label">
            {{ getProgressLabel(metric) }}
          </span>
        </div>
      </div>

      <!-- Description - Only shown when expanded -->
      <div class="metric-description" *ngIf="shouldShowDescription(metric, i)">
        {{ getDescription(metric) }}
      </div>
    </div>
  </div>

  <lib-empty-state *ngIf="!section.fields?.length" message="No analytics data" icon="ðŸ“Š" variant="minimal">
  </lib-empty-state>
</div>
