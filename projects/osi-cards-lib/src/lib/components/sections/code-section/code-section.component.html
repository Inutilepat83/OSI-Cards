<div class="code-section">
  @if (fields.length > 0) {
    @for (field of fields; track trackField($index, field); let i = $index) {
      <div
        class="code-block"
        [class]="getLanguageClass(field)"
        [style.--stagger-index]="getFieldStaggerIndex(i)"
        [ngClass]="getFieldAnimationClass(getFieldId(field, i), i)">

        <!-- Header with filename/language and copy button -->
        <div class="code-header">
          <div class="code-header-left">
            <lucide-icon [name]="getLanguageIcon(field)" [size]="14" class="code-icon"></lucide-icon>
            @if (field.filename) {
              <span class="code-filename">{{ field.filename }}</span>
            } @else {
              <span class="code-language">{{ getLanguageDisplayName(field) }}</span>
            }
          </div>

          <button
            type="button"
            class="code-copy-btn"
            [class.code-copy-btn--copied]="isCopied(i)"
            (click)="copyCode(field, i)"
            [attr.aria-label]="isCopied(i) ? 'Copied!' : 'Copy code'">
            @if (isCopied(i)) {
              <lucide-icon name="check" [size]="14"></lucide-icon>
              <span>Copied!</span>
            } @else {
              <lucide-icon name="copy" [size]="14"></lucide-icon>
              <span>Copy</span>
            }
          </button>
        </div>

        <!-- Code content -->
        <div class="code-content" [class.code-content--with-lines]="field.showLineNumbers !== false">
          @if (field.showLineNumbers !== false) {
            <div class="code-line-numbers" aria-hidden="true">
              @for (line of getCodeLines(field); track $index; let lineIdx = $index) {
                <span
                  class="code-line-number"
                  [class.code-line-number--highlighted]="isLineHighlighted(field, lineIdx)">
                  {{ getLineNumber(field, lineIdx) }}
                </span>
              }
            </div>
          }

          <pre class="code-pre"><code class="code-text">@for (line of getCodeLines(field); track $index; let lineIdx = $index) {<span
              class="code-line"
              [class.code-line--highlighted]="isLineHighlighted(field, lineIdx)">{{ line }}
</span>}          </code></pre>
        </div>

        <!-- Optional label/description -->
        @if (field.label || field.description) {
          <div class="code-footer">
            @if (field.label) {
              <span class="code-label">{{ field.label }}</span>
            }
            @if (field.description) {
              <p class="code-description">{{ field.description }}</p>
            }
          </div>
        }
      </div>
    }
  } @else {
    <div class="code-empty">
      <lucide-icon name="code" [size]="24"></lucide-icon>
      <span>No code snippets</span>
    </div>
  }
</div>

