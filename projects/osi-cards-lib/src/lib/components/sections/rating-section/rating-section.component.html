<div class="rating-section">
  @if (items.length > 0) {
    <!-- Summary header -->
    <div class="rating-summary">
      <div class="rating-summary-score">
        <span class="rating-summary-value">{{ averageRating }}</span>
        <div class="rating-summary-stars">
          @for (star of getStars({ rating: averageRating }); track $index) {
            <lucide-icon
              [name]="star === 'full' ? 'star' : star === 'half' ? 'star-half' : 'star'"
              [size]="16"
              [class.rating-star--full]="star === 'full'"
              [class.rating-star--half]="star === 'half'"
              [class.rating-star--empty]="star === 'empty'"
              class="rating-star">
            </lucide-icon>
          }
        </div>
        <span class="rating-summary-count">{{ items.length }} reviews</span>
      </div>

      <div class="rating-distribution">
        @for (dist of ratingDistribution; track dist.rating) {
          <div class="rating-distribution-row">
            <span class="rating-distribution-label">{{ dist.rating }}</span>
            <div class="rating-distribution-bar">
              <div
                class="rating-distribution-fill"
                [style.width.%]="dist.percentage">
              </div>
            </div>
            <span class="rating-distribution-count">{{ dist.count }}</span>
          </div>
        }
      </div>
    </div>

    <!-- Reviews list -->
    <div class="rating-list">
      @for (item of items; track trackItem($index, item); let i = $index) {
        <div
          class="rating-item"
          [style.--stagger-index]="getItemStaggerIndex(i)"
          [ngClass]="getItemAnimationClass(getItemId(item, i), i)"
          (click)="onItemClick(item)"
          (keydown.enter)="onItemClick(item)"
          tabindex="0"
          role="article">

          <!-- Reviewer info -->
          <div class="rating-reviewer">
            @if (item.avatar) {
              <img
                [src]="item.avatar"
                [alt]="getReviewer(item)"
                class="rating-avatar">
            } @else {
              <div class="rating-avatar rating-avatar--initials">
                {{ getInitials(item) }}
              </div>
            }

            <div class="rating-reviewer-info">
              <span class="rating-reviewer-name">
                {{ getReviewer(item) }}
                @if (item.verified) {
                  <lucide-icon
                    name="badge-check"
                    [size]="14"
                    class="rating-verified"
                    title="Verified">
                  </lucide-icon>
                }
              </span>
              @if (item.date) {
                <span class="rating-date">{{ getFormattedDate(item) }}</span>
              }
            </div>
          </div>

          <!-- Stars -->
          <div class="rating-stars">
            @for (star of getStars(item); track $index) {
              <lucide-icon
                [name]="star === 'full' ? 'star' : star === 'half' ? 'star-half' : 'star'"
                [size]="16"
                [class.rating-star--full]="star === 'full'"
                [class.rating-star--half]="star === 'half'"
                [class.rating-star--empty]="star === 'empty'"
                class="rating-star">
              </lucide-icon>
            }
          </div>

          <!-- Review text -->
          @if (getReview(item)) {
            <p class="rating-review">{{ getReview(item) }}</p>
          }

          <!-- Helpful -->
          @if (item.helpfulCount !== undefined) {
            <div class="rating-helpful">
              <lucide-icon name="thumbs-up" [size]="14"></lucide-icon>
              <span>{{ item.helpfulCount }} found this helpful</span>
            </div>
          }
        </div>
      }
    </div>
  } @else {
    <div class="rating-empty">
      <lucide-icon name="star" [size]="24"></lucide-icon>
      <span>No reviews yet</span>
    </div>
  }
</div>

