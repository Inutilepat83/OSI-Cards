<div class="ai-section ai-section--text-reference section-content">
  <!-- Section Header -->
  <lib-section-header [title]="section.title" [description]="section.description"> </lib-section-header>

  <!-- References List -->
  <div class="references-list" *ngIf="section.fields && section.fields.length > 0">
    <div class="reference-item" *ngFor="let ref of section.fields; let i = index">
      <!-- Reference Number -->
      <span class="reference-number">[{{ i + 1 }}]</span>

      <!-- Reference Content -->
      <div class="reference-content">
        <h4 class="reference-title">{{ getReferenceTitle(ref) }}</h4>
        <div class="reference-text-wrapper" *ngIf="getReferenceContent(ref)">
          <p class="reference-text" [class.reference-text--expanded]="isExpanded(i)" *ngIf="getReferenceContent(ref)">
            {{ getReferenceContent(ref) }}
          </p>
          <button
            *ngIf="shouldShowExpandButton(ref)"
            class="reference-expand-btn"
            type="button"
            (click)="toggleExpanded(i)"
            [attr.aria-expanded]="isExpanded(i)"
            [attr.aria-label]="(isExpanded(i) ? 'Collapse' : 'Expand') + ' reference text'"
          >
            {{ isExpanded(i) ? 'Show less' : 'Show more' }}
          </button>
        </div>

        <!-- Reference Meta -->
        <div class="reference-meta">
          <span class="ref-source" *ngIf="ref.source">{{ ref.source }}</span>
          <span class="ref-type" *ngIf="ref.type">{{ ref.type }}</span>
          <span class="ref-date" *ngIf="ref.date">{{ ref.date }}</span>
        </div>

        <!-- Reference Link -->
        <a [href]="ref.url" class="reference-link" *ngIf="ref.url" target="_blank" rel="noopener"> View source â†’ </a>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <lib-empty-state
    *ngIf="!section.fields || section.fields.length === 0"
    message="No reference data"
    icon="ðŸ“š"
    variant="minimal"
  >
  </lib-empty-state>
</div>
