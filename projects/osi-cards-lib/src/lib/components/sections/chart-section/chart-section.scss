// =====================================================================
// CHART SECTION - Compact, Responsive, Consistent
// =====================================================================

// Use design system (must come before @import)
@use "../../../styles/components/sections/design-system" as *;
@use "../../../styles/components/sections/typography-system" as typo;
@use "../../../styles/osi-cards-mixins" as mixins;
@use "../../../styles/design-system/section-base" as section-base;
@use "../../../styles/responsive" as *;
@use "../../../styles/components/sections/section-animations" as *;

// Import base section styles
@import "../../../styles/components/sections/sections-base";
@import "../../../styles/components/sections/section-shell";

:host {
  display: block;
  width: 100%;
}

.chart-wrapper {
  @include mixins.card-base;
  overflow: hidden;
  min-height: 120px; // 30% of 400px
  height: 120px; // Fixed height at 30% of original 400px
  max-height: 120px; // Prevent exceeding 30% height
  padding: 0; // Remove padding to eliminate blank space
  position: relative; // Required for loading overlay positioning
  border-radius: 0 !important; // Remove border radius

  // Responsive height adjustments (30% of original values)
  @include responsive-down("lg") {
    min-height: 105px; // 30% of 350px
    height: 105px;
    max-height: 105px;
  }

  @include responsive-down("md") {
    min-height: 90px; // 30% of 300px
    height: 90px;
    max-height: 90px;
  }

  @include responsive-down("sm") {
    min-height: 75px; // 30% of 250px
    height: 75px;
    max-height: 75px;
  }

  @include responsive-down("xs") {
    min-height: 60px; // 30% of 200px
    height: 60px;
    max-height: 60px;
  }
}

.chart-container {
  width: 100%;
  height: 100%;
  min-height: 100%;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;

  canvas {
    width: 100% !important;
    height: 100% !important;
    max-width: 100%;
    max-height: 100%;
  }
}

.chart-loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: color-mix(in srgb, var(--background) 85%, transparent);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--osi-section-item-gap); // 6px gap between section items
  z-index: 1000;
  pointer-events: none;
  transition: opacity 0.3s ease;

  .chart-loading-spinner {
    width: 32px;
    height: 32px;
    border: 3px solid color-mix(in srgb, var(--foreground) 20%, transparent);
    border-top-color: var(--status-info, #3b82f6);
    border-radius: 50%;
    animation: chart-spin 1s linear infinite;
  }

  .chart-loading-text {
    @include typo.label-base;
    color: var(--muted-foreground);
    font-size: var(--text-sm);
  }
}

@keyframes chart-spin {
  to {
    transform: rotate(360deg);
  }
}

// Chart.js theme-aware styling
:host ::ng-deep {
  // Ensure chart canvas is visible
  canvas {
    display: block !important;
    max-width: 100%;
    max-height: 100%;
  }

  // Theme-aware chart.js legend styling
  .chartjs-legend {
    color: var(--foreground);
  }

  // Chart.js tooltip styling
  .chartjs-tooltip {
    background-color: var(--osi-section-item-background, var(--card-section-bg)) !important;
    color: var(--foreground) !important;
    border: 1px solid var(--border);
    border-radius: var(--osi-radius-md);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    padding: 8px 12px;
  }

  // Chart.js tooltip text
  .chartjs-tooltip-body {
    color: var(--foreground) !important;
  }

  // Chart.js tooltip title
  .chartjs-tooltip-header {
    color: var(--foreground) !important;
    border-bottom: 1px solid var(--border);
  }
}
