<div
  #container
  class="w-full masonry-container"
  role="grid"
  [attr.aria-label]="'Card sections grid with ' + (sections.length || 0) + ' sections'"
  [attr.aria-busy]="!isLayoutReady || isStreaming"
  [attr.aria-colcount]="currentColumns"
  [class.masonry-container--loading]="!isLayoutReady"
  [class.masonry-container--streaming]="isStreaming"
  [style.--masonry-columns]="currentColumns"
  [style.--masonry-gap.px]="gap"
>
  <!-- Screen reader live region for streaming updates -->
  <div class="sr-only" role="status" aria-live="polite" aria-atomic="true">
    <span *ngIf="isStreaming && positionedSections.length > 0">
      Loading section {{ positionedSections.length }} of card content
    </span>
    <span *ngIf="!isStreaming && isLayoutReady && positionedSections.length > 0">
      Card loaded with {{ positionedSections.length }} sections
    </span>
  </div>

  <!-- CSS GRID: Browser handles ALL positioning automatically! -->
  <div
    *ngFor="let section of sections; let idx = index"
    #itemRef
    class="masonry-item"
    role="gridcell"
    [attr.aria-label]="section.title || 'Section ' + (idx + 1)"
    [attr.aria-colspan]="getColSpan(section)"
    [attr.data-col-span]="getColSpan(section)"
    [attr.data-section-type]="section.type"
    [attr.id]="getSectionId(section)"
    [style.--section-col-span]="getColSpan(section)"
    tabindex="0"
    [class.masonry-item--ready]="isLayoutReady"
  >
    <app-section-renderer [section]="section" (sectionEvent)="onSectionEvent($event)"> </app-section-renderer>
  </div>
</div>
