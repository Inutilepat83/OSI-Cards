:host {
  display: block;
  width: 100%;
}

/* ============================================================
   CONTAINER - CSS Grid with Masonry
   ============================================================ */

.masonry-container {
  display: grid;
  grid-template-columns: repeat(var(--masonry-columns, 3), 1fr);
  gap: var(--masonry-gap, 12px);
  width: 100%;
  padding: 0;
  box-sizing: border-box;
  opacity: 0;
  transition: opacity 0.2s ease;
}

/* Native masonry when supported (Chrome 109+, Firefox 142+) */
@supports (grid-template-rows: masonry) {
  .masonry-container--native {
    grid-template-rows: masonry;
  }
}

/* Absolute positioning polyfill for non-native masonry browsers */
.masonry-container--absolute-polyfill {
  position: relative;
  display: block; /* Override grid for absolute positioning */
  /* Container provides positioning context for absolutely positioned children */
  min-height: 200px; /* Ensure container has minimum height */
}

.masonry-container--absolute-polyfill .masonry-item {
  /* Position, left, top, transform, width set via inline styles from component */
  /* Items start in natural flow for measurement, then switch to absolute positioning */
}

/* Smooth transitions for position changes (only after initial positioning) */
.masonry-container--absolute-polyfill.masonry-container--ready .masonry-item {
  transition:
    left 0.3s cubic-bezier(0.4, 0, 0.2, 1),
    top 0.3s cubic-bezier(0.4, 0, 0.2, 1),
    transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
    width 0.3s cubic-bezier(0.4, 0, 0.2, 1),
    opacity 0.2s ease;
}

.masonry-container--ready {
  opacity: 1;
}

/* ============================================================
   ITEMS - Grid cells with column spans
   ============================================================ */

.masonry-item {
  grid-column: span var(--col-span, 1);
  min-height: 100px;
  box-sizing: border-box;
  overflow: hidden;

  /* Performance optimizations */
  contain: layout style paint;
  display: block;
}

/* Layout variant classes */
.masonry-item--compact {
  /* Tighter spacing for compact mode */
  padding: calc(var(--section-container-padding, 16px) * 0.75);
}

.masonry-item--wide {
  /* More spacing for wide mode */
  padding: calc(var(--section-container-padding, 16px) * 1.1);
}

.masonry-item--default {
  /* Default spacing */
  padding: var(--section-container-padding, 16px);
}

/* Ensure sections are visible and fit their container */
app-section-renderer {
  display: block !important;
  min-height: 80px !important;
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
  overflow: hidden;
}

/* Ensure all child elements respect column boundaries */
.masonry-item * {
  max-width: 100%;
  box-sizing: border-box;
}

/* Tables and other block elements should fit */
.masonry-item table {
  width: 100%;
  max-width: 100%;
  table-layout: auto;
  word-wrap: break-word;
}

/* Prevent any element from exceeding column width */
.masonry-item > * {
  max-width: 100%;
  overflow-x: auto;
}

/* Ensure images have minimum dimensions during load and fit column */
.masonry-item img {
  min-height: 200px;
  width: 100%;
  max-width: 100%;
  height: auto;
  object-fit: contain;
  box-sizing: border-box;
}

/* Ensure media does not blow up height unexpectedly and fits column width */
.masonry-item img,
.masonry-item video,
.masonry-item iframe,
.masonry-item canvas {
  max-width: 100%;
  width: 100%;
  height: auto;
  display: block;
  box-sizing: border-box;
  object-fit: contain;
}

/* Apply aspect ratios for common media types */
.masonry-item img {
  aspect-ratio: 16 / 9;
}

.masonry-item iframe,
.masonry-item video {
  aspect-ratio: 16 / 9;
}

.masonry-item canvas {
  aspect-ratio: 4 / 3;
}

/* Charts and iframes should have minimum height */
.masonry-item iframe,
.masonry-item canvas,
.masonry-item svg {
  min-height: 300px;
}

/* ============================================================
   STREAMING MODE - Disable transitions during active streaming
   ============================================================ */

.masonry-container--streaming .masonry-item {
  transition: opacity 0.3s ease !important;
}

/* ============================================================
   RESPONSIVE
   ============================================================ */

@media (max-width: 768px) {
  .masonry-container {
    padding: 0;
  }
}

/* ============================================================
   REDUCED MOTION
   ============================================================ */

@media (prefers-reduced-motion: reduce) {
  .masonry-container,
  .masonry-item {
    transition: none !important;
    animation: none !important;
  }

  .masonry-container--ready .masonry-item {
    opacity: 1;
  }
}
