:host {
  display: block;
  width: 100%;
}

/* ============================================================
   MASONRY CONTAINER
   ============================================================ */

.masonry-container {
  /* Smooth height transitions using cubic-bezier for natural motion */
  transition: opacity 0.25s ease, 
              height 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  opacity: 1;
  min-height: 400px;
  
  /* Better containment for absolute positioned items */
  contain: layout style paint;
  
  /* GPU acceleration */
  will-change: height;
  transform: translateZ(0);
}

.masonry-container--loading {
  /* Keep full opacity to prevent blinking - use other visual cues instead */
  opacity: 1;
}

/* ═══════════════════════════════════════════════════════════════════════════
   STREAMING MODE - Magical Section Entrance Animations
   ═══════════════════════════════════════════════════════════════════════════ */

/* STREAMING STABILITY: Override loading opacity during streaming to prevent blinking
   When streaming, we want to keep existing content fully visible even during layout recalculations */
.masonry-container--streaming.masonry-container--loading {
  opacity: 1 !important;
}

.masonry-container--streaming {
  /* No container transitions during streaming */
  transition: none !important;
}

/* Base streaming mode - COMPLETE visual stability for existing sections */
.masonry-container--streaming .masonry-item {
  /* Force full opacity always */
  opacity: 1 !important;
  /* Disable ALL transitions during streaming to prevent flickering */
  transition: none !important;
  will-change: auto;
  /* Reset any filters that might cause visual changes */
  filter: none !important;
}

/* Non-animating items must remain completely stable - absolute stability */
.masonry-container--streaming .masonry-item:not(.masonry-item--animating) {
  animation: none !important;
  filter: none !important;
  /* Keep positioned but don't transform */
  transform: translateZ(0) !important;
  /* Ensure visibility */
  visibility: visible !important;
}

/* Gentle entrance animation ONLY for NEW sections (not already rendered) */
.masonry-item--animating {
  /* Simple fade-in with subtle slide - NO continuous glow animation */
  animation: masonry-gentle-enter 0.35s ease-out forwards;
  /* Subtle initial shadow - no harsh glow */
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  /* Enable pseudo-element positioning */
  position: relative;
  overflow: hidden;
}

/* Gentle fade-in with subtle slide - no blur, no bounce */
@keyframes masonry-gentle-enter {
  0% {
    opacity: 0;
    transform: translateY(8px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Shimmer sweep overlay - more subtle */
.masonry-item--animating::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    110deg,
    transparent 40%,
    rgba(255, 149, 0, 0.08) 50%,
    transparent 60%
  );
  animation: shimmer-sweep 0.5s ease-out forwards;
  pointer-events: none;
  border-radius: inherit;
  z-index: 10;
}

@keyframes shimmer-sweep {
  0% { transform: translateX(-100%); opacity: 0.8; }
  100% { transform: translateX(100%); opacity: 0; }
}

/* Subtle inner highlight - reduced intensity */
.masonry-item--animating::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  box-shadow: inset 0 0 15px rgba(255, 149, 0, 0.15);
  animation: inner-flash 0.4s ease-out forwards;
  pointer-events: none;
  z-index: 5;
}

@keyframes inner-flash {
  0% { opacity: 0.6; }
  100% { opacity: 0; }
}

.masonry-container--streaming .masonry-item--ready {
  /* Keep position transitions disabled during streaming */
  transition: top 0s, left 0s, width 0s !important;
}

/* ============================================================
   MASONRY ITEMS - FLIP ANIMATION SUPPORT
   ============================================================ */

.masonry-item {
  /* Start at full opacity - NO flash from 0.3 to 1 */
  opacity: 1;
  
  /* GPU-accelerated transforms */
  will-change: top, left, width;
  backface-visibility: hidden;
  transform: translateZ(0);
  
  /* Pointer events enabled */
  pointer-events: auto;
  
  /* No opacity transition needed since we start at 1 */
  transition: none;
  
  /* CSS containment for rendering isolation */
  contain: layout style paint;
}

.masonry-item--ready {
  opacity: 1;
  
  /* FLIP-style transitions for smooth repositioning
   * Using cubic-bezier for natural easing
   * NO opacity transition - already at 1
   */
  transition: 
    top 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94),
    left 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94),
    width 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94),
    transform 0.3s ease;
}

/* Staggered transition delays for position changes */
.masonry-item--ready:nth-child(1) { transition-delay: 0ms; }
.masonry-item--ready:nth-child(2) { transition-delay: 30ms; }
.masonry-item--ready:nth-child(3) { transition-delay: 60ms; }
.masonry-item--ready:nth-child(4) { transition-delay: 90ms; }
.masonry-item--ready:nth-child(5) { transition-delay: 120ms; }
.masonry-item--ready:nth-child(6) { transition-delay: 150ms; }
.masonry-item--ready:nth-child(7) { transition-delay: 180ms; }
.masonry-item--ready:nth-child(8) { transition-delay: 210ms; }
.masonry-item--ready:nth-child(n+9) { transition-delay: 240ms; }

/* Staggered animation delays for cascade effect on new sections - reduced for smoother feel */
.masonry-item--animating:nth-child(1) { animation-delay: 0ms; }
.masonry-item--animating:nth-child(2) { animation-delay: 40ms; }
.masonry-item--animating:nth-child(3) { animation-delay: 80ms; }
.masonry-item--animating:nth-child(4) { animation-delay: 120ms; }
.masonry-item--animating:nth-child(5) { animation-delay: 160ms; }
.masonry-item--animating:nth-child(6) { animation-delay: 200ms; }
.masonry-item--animating:nth-child(7) { animation-delay: 240ms; }
.masonry-item--animating:nth-child(8) { animation-delay: 280ms; }
.masonry-item--animating:nth-child(n+9) { animation-delay: 320ms; }

/* Ensure sections have proper containment */
.masonry-item > * {
  display: block;
  width: 100%;
  height: auto;
}

/* ============================================================
   RESPONSIVE OPTIMIZATIONS
   ============================================================ */

/* Mobile: faster transitions */
@media (max-width: 768px) {
  .masonry-container {
    min-height: 300px;
  }
  
  .masonry-item {
    /* Faster transitions on mobile */
    transition: opacity 0.3s ease;
  }
  
  .masonry-item--ready {
    transition: 
      top 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
      left 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
      width 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
      opacity 0.4s ease 0.05s;
  }
  
  /* Reduced stagger on mobile */
  .masonry-item--ready:nth-child(1) { transition-delay: 0ms; }
  .masonry-item--ready:nth-child(2) { transition-delay: 20ms; }
  .masonry-item--ready:nth-child(3) { transition-delay: 40ms; }
  .masonry-item--ready:nth-child(4) { transition-delay: 60ms; }
  .masonry-item--ready:nth-child(n+5) { transition-delay: 80ms; }
  
  /* Reduced animation stagger on mobile */
  .masonry-item--animating:nth-child(1) { animation-delay: 0ms; }
  .masonry-item--animating:nth-child(2) { animation-delay: 50ms; }
  .masonry-item--animating:nth-child(3) { animation-delay: 100ms; }
  .masonry-item--animating:nth-child(4) { animation-delay: 150ms; }
  .masonry-item--animating:nth-child(n+5) { animation-delay: 200ms; }
}

/* Wide screen: allow more height */
@media (min-width: 1400px) {
  .masonry-container {
    min-height: 500px;
  }
}

/* ============================================================
   REDUCED MOTION SUPPORT
   ============================================================ */

@media (prefers-reduced-motion: reduce) {
  .masonry-container {
    transition: none;
  }
  
  .masonry-item,
  .masonry-item--ready,
  .masonry-item--animating {
    transition: none !important;
    animation: none !important;
    transition-delay: 0ms !important;
    animation-delay: 0ms !important;
    opacity: 1;
    filter: none;
  }
  
  .masonry-item--animating::before,
  .masonry-item--animating::after {
    display: none;
  }
}
