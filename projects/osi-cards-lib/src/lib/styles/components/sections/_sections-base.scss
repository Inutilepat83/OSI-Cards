// =====================================================================
// SECTIONS BASE - Clean, Consistent Card Styles
// =====================================================================
//
// Uses CSS variables from master tokens. No hardcoded shadows or effects.
//
// =====================================================================

@use "../../tokens/master" as *;
@use "section-animations" as *;

// =====================================================================
// GRID MIXINS
// =====================================================================

@mixin section-grid($min-width: var(--section-grid-min-width), $gap: var(--section-card-gap)) {
  display: grid;
  gap: $gap;
  grid-template-columns: repeat(auto-fit, minmax($min-width, 1fr));
  min-height: 0;
  box-sizing: border-box;
  max-width: 100%;
  overflow-x: hidden;
  word-wrap: break-word;
  overflow-wrap: break-word;

  @media (max-width: 600px) {
    grid-template-columns: 1fr;
  }

  @media (max-width: 420px) {
    grid-template-columns: 1fr;
  }
}

@mixin section-grid-responsive(
  $min-width: var(--section-grid-min-width),
  $gap: var(--section-card-gap),
  $tablet-breakpoint: 820px
) {
  display: grid;
  gap: $gap;
  grid-template-columns: repeat(auto-fit, minmax($min-width, 1fr));
  min-height: 0;
  box-sizing: border-box;
  max-width: 100%;
  overflow-x: hidden;
  word-wrap: break-word;
  overflow-wrap: break-word;

  @media (max-width: $tablet-breakpoint) {
    grid-template-columns: 1fr;
  }

  @media (max-width: 600px) {
    grid-template-columns: 1fr;
  }
}

// =====================================================================
// RESPONSIVE SINGLE COLUMN MIXIN
// =====================================================================

@mixin responsive-single-column($breakpoint: 600px) {
  @media (max-width: $breakpoint) {
    grid-template-columns: 1fr !important;
  }
}

// =====================================================================
// TEXT OVERFLOW ELLIPSIS MIXIN
// =====================================================================

@mixin text-overflow-ellipsis($lines: 1) {
  @if $lines == unset {
    display: block;
    -webkit-line-clamp: unset;
    overflow: visible;
  } @else {
    display: -webkit-box;
    -webkit-line-clamp: $lines;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  word-break: break-word;
  overflow-wrap: break-word;
  word-wrap: break-word;
  max-width: 100%;
  box-sizing: border-box;
}

// =====================================================================
// EXPANDABLE TEXT MIXIN
// =====================================================================

@mixin expandable-text($max-lines: 3) {
  display: -webkit-box;
  -webkit-line-clamp: $max-lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
  word-break: break-word;
  overflow-wrap: break-word;
  word-wrap: break-word;
  max-width: 100%;
  box-sizing: border-box;

  &--expanded {
    display: block;
    -webkit-line-clamp: unset;
    overflow: visible;
  }
}

// =====================================================================
// BUTTON TEXT MINIMAL MIXIN
// =====================================================================

@mixin button-text-minimal {
  align-self: flex-start;
  background: none;
  border: none;
  color: var(--accent);
  font-size: 0.7rem;
  font-weight: var(--font-medium);
  cursor: pointer;
  padding: var(--osi-spacing-compact-xs, 2px) 0;
  transition: opacity 200ms var(--ease-out);

  &:hover {
    text-decoration: underline;
    opacity: 0.8;
  }

  &:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
    border-radius: 2px;
  }
}

// =====================================================================
// UNIVERSAL CARD MIXIN - Single Source of Truth
// =====================================================================
// This is the PRIMARY base mixin for all card styling.
// All card variants should extend this mixin.
// Uses standardized --osi-section-item-* tokens.

@mixin card($spacing: "normal") {
  // Background & Border - using standardized tokens
  background: var(--osi-section-item-background);
  border: var(--osi-section-item-border);
  border-radius: var(--osi-section-item-border-radius);
  box-shadow: var(--osi-section-item-shadow);

  // Padding - using standardized tokens with spacing parameter
  @if $spacing == "compact" {
    padding: var(--osi-section-item-padding-compact);
  } @else if $spacing == "spacious" {
    padding: var(--osi-section-item-padding-spacious);
  } @else {
    padding: var(--osi-section-item-padding-normal);
  }

  // Layout
  display: flex;
  flex-direction: column;
  gap: var(--osi-section-item-gap);
  min-height: var(--card-min-height, auto);

  // Interaction
  cursor: pointer;
  position: relative;
  overflow: hidden;
  overflow-x: hidden; /* Prevent horizontal scrolling */
  width: 100% !important; // Ensure full width
  max-width: 100% !important; // Ensure full width
  box-sizing: border-box !important; // Include padding/border in width
  text-align: left;
  word-wrap: break-word;
  overflow-wrap: break-word;

  // Transitions - using standardized transition token
  transition: var(--osi-section-item-transition);

  // Metal reflection effect (default left-to-right)
  // Position-based direction will be handled by CSS selectors
  @include section-metal-reflection("ltr");

  &:hover {
    // Keep background unchanged - only border and shadow change
    // background: var(--osi-section-item-background-hover); // Removed - background stays the same
    border-color: var(--osi-section-item-border-hover-enhanced-color);
    box-shadow: var(--osi-section-item-shadow-hover-enhanced);
  }

  &:focus-visible {
    outline: none;
  }

  @media (prefers-reduced-motion: reduce) {
    transition: none;
  }
}

// =====================================================================
// LIST ITEM MIXIN
// =====================================================================
// Standardized list item styling extending base card
// Used for items within list sections

@mixin list-item($spacing: "normal") {
  @include card($spacing);

  // List-specific styling
  // Items in lists typically don't need borders or shadows
  border: none;
  box-shadow: none;
  background: transparent;

  // Use margin for list item separation (not padding)
  margin-bottom: var(--osi-section-item-margin-sm);

  &:not(:last-child) {
    border-bottom: 1px solid var(--border);
    padding-bottom: var(--osi-section-item-gap-md);
    margin-bottom: var(--osi-section-item-gap-md);
  }

  &:hover {
    background: var(--osi-section-item-background-hover);
  }

  // No accent border for list items
  &::before {
    display: none;
  }
}

// =====================================================================
// LIST CONTAINER MIXIN
// =====================================================================
// Container for list items - uses standardized tokens

@mixin list-container($spacing: "normal") {
  @include card($spacing);

  // List containers can have different styling if needed
  gap: var(--osi-section-item-gap);
}

// =====================================================================
// UNIFIED SECTION CARD CLASS
// =====================================================================

.unified-card {
  @include card;
}

.section-card {
  @include card;
  & {
    width: 100% !important; // Ensure full width
    max-width: 100% !important; // Ensure full width
    box-sizing: border-box !important; // Include padding/border in width
  }
}

// =====================================================================
// GLOBAL SECTION ITEM HOVER ENHANCEMENT
// =====================================================================
// Ensure all section items get enhanced hover effects
// This applies to any element with .section-item class
// Higher specificity to ensure it overrides component-specific styles
// Each section item gets its own independent hover animation

.section-item {
  // Enhanced hover effects for all section items
  // Ensure border and shadow transitions are included
  transition:
    border-color var(--osi-card-transition-normal, 0.22s) cubic-bezier(0.4, 0, 0.2, 1),
    box-shadow var(--osi-card-transition-normal, 0.22s) cubic-bezier(0.4, 0, 0.2, 1),
    var(--osi-section-item-transition);

  // Ensure each section item has its own metal reflection animation
  position: relative;
  overflow: hidden;

  // Metal reflection pseudo-element for each individual item
  // Using ::before to avoid conflicts with components that use ::after
  &::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 1;
    opacity: 0;
    border-radius: inherit;
    animation: none;

    // Default: left-to-right reflection with sweep animation (more discrete)
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(255, 255, 255, 0.2) 20%,
      rgba(255, 255, 255, 0.3) 40%,
      rgba(255, 255, 255, 0.2) 60%,
      transparent 100%
    );
    width: 50%;

    // Use overlay blend mode for metallic appearance
    mix-blend-mode: overlay;
  }

  &:hover {
    // Keep background unchanged - only border and shadow change
    // Use !important to ensure these styles take precedence
    border-color: var(--osi-section-item-border-hover-enhanced-color) !important;
    box-shadow: var(--osi-section-item-shadow-hover-enhanced) !important;
    // Ensure background doesn't change
    background: var(--osi-section-item-background) !important;

    // Trigger metal sweep animation for this specific item independently
    // Default direction (will be overridden by position-based selectors below)
    &::before {
      opacity: 1;
      animation: metal-sweep-ltr 0.23s ease-out forwards;
    }
  }

  // Reset animation when hover ends so it can play again on next hover for this item
  &:not(:hover)::before {
    animation: none;
    opacity: 0;
  }

  @media (prefers-reduced-motion: reduce) {
    transition: none;
    &::after {
      display: none;
    }
  }
}

// =====================================================================
// TYPOGRAPHY MIXINS - Use CSS Variables
// =====================================================================

@mixin metric-label {
  font-size: var(--card-label-font-size);
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  color: var(--muted-foreground);
  line-height: 1.3;
  font-family: inherit;
  margin-bottom: 0.05em; // Reduced gap between label and value
}

@mixin metric-value {
  font-size: var(--card-value-font-size);
  font-weight: 600;
  color: var(--foreground);
  letter-spacing: -0.01em;
  line-height: 1.3;
  font-family: inherit;
}

@mixin section-description {
  font-size: var(--card-subtitle-font-size);
  color: var(--muted-foreground);
  line-height: 1.3; // Reduced from 1.5 for tighter spacing
  font-weight: 400;
  font-family: inherit;
}

// Legacy aliases
@mixin section-label {
  @include metric-label;
}

@mixin section-value {
  @include metric-value;
}

// =====================================================================
// EMPTY STATE
// =====================================================================

@mixin section-empty-state {
  padding: var(--osi-section-container-padding);
  text-align: center;
  color: var(--muted-foreground);
  border: var(--osi-section-item-border-width) dashed var(--border);
  border-radius: var(--osi-section-item-border-radius);
  background: var(--osi-section-item-background);
  min-height: auto;

  // Use standardized spacing
  margin: var(--osi-section-item-margin-md);
}

@mixin section-empty-icon {
  margin: 0 auto var(--card-gap);
  opacity: 0.5;
}

// =====================================================================
// TREND COLORS
// =====================================================================

@mixin trend-colors {
  &.trend--up {
    color: #{$osi-color-trend-up};
  }

  &.trend--down {
    color: #{$osi-color-trend-down};
  }

  &.trend--stable {
    color: #{$osi-color-trend-stable};
  }

  &.trend--neutral {
    color: #{$osi-color-trend-neutral};
  }
}

// =====================================================================
// STATUS CLASSES
// =====================================================================

.status--completed,
.status--success {
  color: #{$success-color};
  background: #{$success-color-10};
}

.status--active,
.status--in-progress {
  color: var(--accent);
  background: #{$brand-color-10};
}

.status--pending,
.status--warning {
  color: #{$warning-color};
  background: #{$warning-color-10};
}

.status--blocked,
.status--cancelled,
.status--delayed,
.status--inactive,
.status--error {
  color: #{$error-color};
  background: #{$error-color-10};
}

.status--default {
  color: var(--muted-foreground);
  background: var(--muted);
}

// =====================================================================
// PRIORITY CLASSES
// =====================================================================

.priority--high {
  color: #{$error-color};
  background: #{$error-color-10};
}

.priority--medium {
  color: #{$warning-color};
  background: #{$warning-color-10};
}

.priority--low {
  color: #{$success-color};
  background: #{$success-color-10};
}

.priority--default {
  color: var(--muted-foreground);
  background: var(--muted);
}

// =====================================================================
// POSITION-BASED METAL REFLECTION DIRECTION
// =====================================================================
//
// Detects card position in grid and applies appropriate reflection direction.
// Left-positioned cards: left-to-right reflection
// Right-positioned cards: right-to-left reflection
//

// For masonry grid items - detect position based on column
// Targets section items nested within masonry items
// Left side items: right-to-left animation (rtl)
// Right side items: left-to-right animation (ltr)
.masonry-container,
.masonry-grid-container {
  // Items in first columns (left side) - right-to-left reflection
  .masonry-item:nth-child(4n + 1),
  .masonry-item:nth-child(4n + 2) {
    // Target all section items and cards within the masonry item
    .section-item,
    .unified-card,
    .section-card,
    [class*="-card"]:not([class*="__"]),
    [class*="-item"]:not([class*="__"]) {
      &::before {
        // Right-to-left reflection for left side items
        background: linear-gradient(
          270deg,
          transparent 0%,
          rgba(255, 255, 255, 0.2) 20%,
          rgba(255, 255, 255, 0.3) 40%,
          rgba(255, 255, 255, 0.2) 60%,
          transparent 100%
        ) !important;
      }

      &:hover::before {
        animation: metal-sweep-rtl 0.23s ease-out forwards !important;
      }
    }
  }

  // Items in last columns (right side) - left-to-right reflection
  .masonry-item:nth-child(4n + 3),
  .masonry-item:nth-child(4n + 4),
  .masonry-item[data-col-span="2"]:nth-child(odd),
  .masonry-item[data-col-span="3"],
  .masonry-item[data-col-span="4"] {
    // Target all section items and cards within the masonry item
    .section-item,
    .unified-card,
    .section-card,
    [class*="-card"]:not([class*="__"]),
    [class*="-item"]:not([class*="__"]) {
      &::before {
        // Left-to-right reflection for right side items
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.2) 20%,
          rgba(255, 255, 255, 0.3) 40%,
          rgba(255, 255, 255, 0.2) 60%,
          transparent 100%
        ) !important;
      }

      &:hover::before {
        animation: metal-sweep-ltr 0.23s ease-out forwards !important;
      }
    }
  }
}

// For CSS Grid layouts - detect based on grid column position
@supports (grid-template-rows: masonry) {
  .masonry-container--native {
    // Items starting in first columns (left side) - right-to-left reflection
    .masonry-item:nth-child(4n + 1),
    .masonry-item:nth-child(4n + 2) {
      .section-item,
      .unified-card,
      .section-card,
      [class*="-card"]:not([class*="__"]),
      [class*="-item"]:not([class*="__"]) {
        &::before {
          // Right-to-left reflection for left side items
          background: linear-gradient(
            270deg,
            transparent 0%,
            rgba(255, 255, 255, 0.2) 20%,
            rgba(255, 255, 255, 0.3) 40%,
            rgba(255, 255, 255, 0.2) 60%,
            transparent 100%
          ) !important;
        }

        &:hover::before {
          animation: metal-sweep-rtl 0.23s ease-out forwards !important;
        }
      }
    }

    // Items in last columns (right side) - left-to-right reflection
    .masonry-item:nth-child(4n + 3),
    .masonry-item:nth-child(4n + 4) {
      .section-item,
      .unified-card,
      .section-card,
      [class*="-card"]:not([class*="__"]),
      [class*="-item"]:not([class*="__"]) {
        &::before {
          // Left-to-right reflection for right side items
          background: linear-gradient(
            90deg,
            transparent 0%,
            rgba(255, 255, 255, 0.2) 20%,
            rgba(255, 255, 255, 0.3) 40%,
            rgba(255, 255, 255, 0.2) 60%,
            transparent 100%
          ) !important;
        }

        &:hover::before {
          animation: metal-sweep-ltr 0.23s ease-out forwards !important;
        }
      }
    }
  }
}

// =====================================================================
// REDUCED MOTION
// =====================================================================

@media (prefers-reduced-motion: reduce) {
  .unified-card,
  .section-card,
  [class*="__card"],
  [class*="-card"],
  [class*="__item"],
  [class*="-item"] {
    transition: none;
    animation: none;
  }
}

// =====================================================================
// ANIMATION SYSTEM - Standardized
// =====================================================================
// Single unified animation system for all items/fields

@keyframes item-stream {
  0% {
    opacity: 0;
    transform: translate3d(0, var(--osi-motion-distance-sm, 8px), 0);
  }
  100% {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

// Unified animation mixin for all items and fields
@mixin item-animation {
  // Standard streaming state
  &.item-streaming {
    animation: item-stream var(--osi-section-item-animation-duration, 220ms)
      var(--osi-section-item-animation-easing, cubic-bezier(0.4, 0, 0.2, 1)) forwards;
  }

  // Completed state (animation done)
  &.item-entered {
    animation: none;
  }

  // Stagger delays for sequential animations
  @for $i from 0 through 15 {
    &.item-stagger-#{$i} {
      animation-delay: calc(#{$i} * var(--osi-section-item-stagger-delay, 30ms));
    }
  }

  // Respect reduced motion preferences
  @media (prefers-reduced-motion: reduce) {
    animation: none !important;
  }
}

// Legacy support mixins (deprecated but kept for backward compatibility)
@mixin section-item-animation {
  @include item-animation;
  @warn "section-item-animation is deprecated. Use @include item-animation instead.";

  // Legacy class name support
  &.section-item-streaming {
    @extend .item-streaming;
  }
  &.section-item-entered {
    @extend .item-entered;
  }
}

@mixin legacy-item-animation {
  @include item-animation;
  @warn "legacy-item-animation is deprecated. Use @include item-animation instead.";
}

@mixin legacy-field-animation {
  @include item-animation;
  @warn "legacy-field-animation is deprecated. Use @include item-animation instead.";

  // Legacy class name support
  &.field-streaming {
    @extend .item-streaming;
  }
  &.field-entered {
    @extend .item-entered;
  }
}
